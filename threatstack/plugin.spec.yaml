plugin_spec_version: v2
extension: plugin
products: [insightconnect]
name: threatstack
title: Threat Stack
description: Get information about alerts, assets, policies, and more
version: 1.0.1
vendor: rapid7
support: community
status: []
resources:
  source_url: https://github.com/rapid7/insightconnect-plugins/tree/master/threatstack
  license_url: https://github.com/rapid7/insightconnect-plugins/blob/master/LICENSE
  vendor_url: https://www.threatstack.com
tags:
- threatstack
- ts
- cloud
hub_tags:
  use_cases: [threat_detection_and_response, asset_inventory, alerting_and_notifications]
  keywords: [threatstack, ts, cloud]
  features: []
language: python

types:
  alert:
    id:
      type: string
      title: ID
      required: false
      description: ID of the alert
    title:
      type: string
      title: Title
      required: false
      description: Title of the alert
    datasource:
      type: string
      title: Datasource
      required: false
      description: Indicates whether this alert was generated from a CloudTrail event or Agent event. Agent events will have AgentId
    createdAt:
      type: string
      title: Created At
      required: false
      description: Date and time the alert was fired
    isDismissed:
      type: boolean
      title: Is Dismissed
      required: false
      description: Flag that shows if the alert was dismissed
    dismissedAt:
      type: string
      title: Dismissed At
      required: false
      description: Date and time the alert was dismissed
    dismissReason:
      type: string
      title: Dismiss Reason
      required: false
      description: Either BUSINESS_OP, COMPANY_POLICY, MAINTENANCE, NONE, AUTO_DISMISS, or OTHER
    dismissReasonText:
      type: string
      title: Dismiss Reason Text
      required: false
      description: Reason the alert was dismissed if dismiss reason is OTHER
    dismissedBy:
      type: string
      title: Dismissed By
      required: false
      description: Person that dismissed the alert
    severity:
      type: number
      title: Severity
      required: true
      description: Severity of the alert. Either 1, 2, or 3
    agentId:
      type: string
      title: Agent ID
      required: false
      description: ID of the agent that generated the alert
    ruleId:
      type: string
      title: Rule ID
      required: false
      description: ID of the rule that generated the alert
    rulesetId:
      type: string
      title: Ruleset ID
      required: false
      description: ID of the ruleset that generated the alert

  ip_address:
    private:
      title: "Private"
      type: "[]string"
      description: "Private IP address used to reach this Agent"
      required: false
    link_local:
      title: "Link Local"
      type: "[]string"
      description: "Link local IP address used to reach this Agent"
      required: false
    public:
      title: "Private"
      type: "[]string"
      description: "Public IP address used to reach this Agent"
      required: false

  tag:
    key:
      title: "Key"
      type: string
      description: "Key"
      required: false
    value:
      title: "Value"
      type: string
      description: "Value"
      required: false
    source:
      title: "Source"
      type: string
      description: "Source, e.g. ec2"
      required: false

  agent:
    status:
      title: "Status"
      type: string
      description: "The current status of the Agent"
      required: false
    kernel:
      title: "Kernel"
      type: string
      description: "The kernel version for the server the Agent is installed on"
      required: false
    lastReportedAt:
      title: "Last Reported At"
      type: string
      description: "The date and time Threat Stack last received a message from the Agent"
      required: false
    name:
      title: "Name"
      type: string
      description: "The name for the Agent as defined at the time of installation. If a name was not provided during installation, then the Agent inherits the hostname"
      required: false
    tags:
      title: "Tags"
      type: "[]tag"
      description: "The Threat Stack tags on the server associated with the Agent. Includes AWS tags if available and applicable"
      required: false
    instanceId:
      title: "Instance ID"
      type: string
      description: "Unique ID of the cloud server if available, e.g. i-0fb579452b04eea738"
      required: false
    agentType:
      title: "Agent Type"
      type: string
      description: "Either 'monitor' or 'investigate'"
      required: false
    hostname:
      title: "Hostname"
      type: string
      description: "The hostname of the server the Agent is installed on"
      required: false
    version:
      title: "Version"
      type: string
      description: "The current version of the Agent"
      required: false
    ipAddresses:
      title: "IP Addresses"
      type: ip_address
      description: "IP addresses"
      required: false
    osVersion:
      title: "OS Version"
      type: string
      description: "Operating system and its version number"
      required: false
    id:
      title: "ID"
      type: string
      description: "Unique ID of the agent"
      required: true
    createdAt:
      title: "Created At"
      type: string
      description: "The date and time the Agent activated"
      required: true
    description:
      title: "Description"
      type: string
      description: "The description for the Agent"
      required: false

  event:
    event_type:
      title: "Event Type"
      type: string
      description: "Event type, e.g. cloudtrail"
      required: false
    eventClass:
      title: "Event Class"
      type: string
      description: "Event class, e.g. CloudtrailEvent"
      required: false
    user:
      title: "User"
      type: string
      description: "User"
      required: false
    agent_id:
      title: "Agent ID"
      type: string
      description: "Agent ID"
      required: false
    _id:
      title: "Event ID"
      type: string
      description: "Event ID"
      required: true
    timestamp:
      title: "Timestamp"
      type: number
      description: "Timestamp"
      required: false
    organization_id:
      title: "Timestamp"
      type: string
      description: "Organization ID"
      required: false
    miscellaneous:
      title: "Miscellaneous"
      type: object
      description: "Miscellaneous event data not found across all event types"
      required: false

connection:
  api_key:
    title: API Key
    type: credential_secret_key
    description: REST API key
    required: true
  user_id:
    title: User ID
    type: string
    description: User ID
    required: true
  org_id:
    title: Org ID
    type: string
    description: Threat Stack Organization ID
    required: true
  timeout:
    title: Timeout
    type: integer
    description: API timeout
    required: false
    default: 120

actions:
  get_agent:
    title: Get Agent
    description: Get agent data
    input:
      agent_id:
        type: string
        description: Agent ID e.g. 597b2c751b7cc18fcf028e52
        required: true
    output:
      agent:
        type: agent
        description: Detailed agent data
        required: true
  get_agents:
    title: Get Agents
    description: Get agent data
    input:
      start:
        type: string
        description: Start date e.g. 2017-01-01
        required: false
      end:
        type: string
        description: End date e.g. 2018-01-01
        required: false
    output:
      agents:
        type: '[]agent'
        description: List of agents
        required: true
      count:
        type: integer
        description: Number of agents
        required: true

  get_alert:
    title: Get Alert
    description: Get alert data by ID
    input:
      alert_id:
        type: string
        title: Alert ID
        description: Alert ID e.g. 597b8c751c7ff17fcf028e54
        required: true
    output:
      alert:
        type: alert
        title: Alert
        description: Detailed alert data
        required: true

  get_alerts:
    title: Get Alerts
    description: Get alerts by filter
    input:
      start:
        type: string
        description: Start date e.g. 2017-01-01
        required: false
      end:
        type: string
        description: End date e.g. 2018-01-01
        required: false
    output:
      alerts:
        type: '[]alert'
        description: List of alerts
        required: true
      count:
        type: integer
        description: Number of alerts
        required: true

  get_events:
    title: Get Events
    description: Get events which contributed to an alert
    input:
      alert_id:
        title: Alert ID
        type: string
        description: Alert ID
        required: true
    output:
      events:
        type: '[]event'
        description: List of events
        required: true
      count:
        type: integer
        description: Number of events
        required: true

  get_policy:
    title: Get Policy
    description: Get policy
    input:
      policy_id:
        type: string
        title: Policy ID
        description: Threat Stack policy ID
        required: true
      fields:
        type: '[]string'
        description: Fields to return
        required: false
    output:
      policy:
        type: '[]object'
        description: Policy data
        required: true

  get_policies:
    title: Get Policies
    description: Get policies
    input:
      fields:
        type: '[]string'
        description: Fields to return
        required: false
    output:
      policies:
        type: '[]object'
        description: Array of policies
        required: true
      count:
        type: integer
        description: Number of policies
        required: true
