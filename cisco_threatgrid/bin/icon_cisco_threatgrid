#!/usr/bin/env python
# GENERATED BY KOMAND SDK - DO NOT EDIT
import os
import json
from sys import argv

Name = "Cisco ThreatGrid"
Vendor = "rapid7"
Version = "1.3.1"
Description = "This plugin retrieves malware reports, report samples and URLs for analysis to Cisco ThreatGrid server Cisco ThreatGrid combines advanced sandboxing with threat intelligence into one unified solution to protect organizations from malware"


def main():
    if 'http' in argv:
        if os.environ.get("GUNICORN_CONFIG_FILE"):
            with open(os.environ.get("GUNICORN_CONFIG_FILE")) as gf:
                gunicorn_cfg = json.load(gf)
                if gunicorn_cfg.get("worker_class", "sync") == "gevent":
                    from gevent import monkey
                    monkey.patch_all()
        elif 'gevent' in argv:
            from gevent import monkey
            monkey.patch_all()

    import komand
    from icon_cisco_threatgrid import connection, actions, triggers

    class ICONCiscoThreatgrid(komand.Plugin):
        def __init__(self):
            super(self.__class__, self).__init__(
                name=Name,
                vendor=Vendor,
                version=Version,
                description=Description,
                connection=connection.Connection()
            )
            self.add_action(actions.GetSampleAnalysis())

            self.add_action(actions.SearchForSampleReportByDomain())

            self.add_action(actions.SearchForSampleReportById())

            self.add_action(actions.SearchForSampleReportBySha256())

            self.add_action(actions.SubmitSample())

            self.add_action(actions.SubmitUrl())


    """Run plugin"""
    cli = komand.CLI(ICONCiscoThreatgrid())
    cli.run()


if __name__ == "__main__":
    main()
