#!/usr/bin/env python
# GENERATED BY INSIGHT-PLUGIN - DO NOT EDIT
import os
import json
from sys import argv

Name = "Proofpoint TAP"
Vendor = "rapid7"
Version = "4.1.13"
Description = "[Proofpoint Targeted Attack Protection](https://www.proofpoint.com/us/products/ransomware-and-targeted-attack-protection) (TAP) helps you stay ahead of attackers with an innovative approach that detects, analyzes and blocks advanced threats before they reach your inbox. This plugin enables users to parse TAP alerts"


def main():
    if 'http' in argv:
        if os.environ.get("GUNICORN_CONFIG_FILE"):
            with open(os.environ.get("GUNICORN_CONFIG_FILE")) as gf:
                gunicorn_cfg = json.load(gf)
                if gunicorn_cfg.get("worker_class", "sync") == "gevent":
                    from gevent import monkey
                    monkey.patch_all()
        elif 'gevent' in argv:
            from gevent import monkey
            monkey.patch_all()

    import insightconnect_plugin_runtime
    from komand_proofpoint_tap import connection, actions, triggers, tasks

    class ICONProofpointTap(insightconnect_plugin_runtime.Plugin):
        def __init__(self):
            super(self.__class__, self).__init__(
                name=Name,
                vendor=Vendor,
                version=Version,
                description=Description,
                connection=connection.Connection()
            )
            self.add_action(actions.ParseTapAlert())
        
            self.add_action(actions.GetBlockedClicks())
        
            self.add_action(actions.GetPermittedClicks())
        
            self.add_action(actions.GetBlockedMessages())
        
            self.add_action(actions.GetDeliveredThreats())
        
            self.add_action(actions.GetAllThreats())
        
            self.add_action(actions.GetTopClickers())
        
            self.add_action(actions.UrlDecode())
        
            self.add_action(actions.FetchForensics())
        
            self.add_task(tasks.MonitorEvents())
        

    """Run plugin"""
    cli = insightconnect_plugin_runtime.CLI(ICONProofpointTap())
    cli.run()


if __name__ == "__main__":
    main()
