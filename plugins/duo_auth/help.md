# Description

[Duo](https://duo.com/)'s Trusted Access platform verifies the identity of your users with two-factor authentication and security health of their devices before they connect to the apps they use. The Duo Auth InsightConnect plugin enables users to create and send push notifications from within automation workflows

# Key Features

* Send push notifications for two-factor authentication

# Requirements

* Requires a Duo integration key
* Requires a Duo secret key
* Requires a Duo hostname

# Supported Product Versions

* Duo Client 5.3.0

# Documentation

## Setup

The connection configuration accepts the following parameters:  

|Name|Type|Default|Required|Description|Enum|Example|Placeholder|Tooltip|
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
|hostname|string|None|True|Enter the Duo API hostname and secret key|None|ExampleHostname|None|None|
|integration_key|credential_secret_key|None|True|API integration key|None|{"secretKey": "9de5069c5afe602b2ea0a04b66beb2c0"}|None|None|
|secret_key|credential_secret_key|None|True|API secret key|None|{"secretKey": "9de5069c5afe602b2ea0a04b66beb2c0"}|None|None|

Example input:

```
{
  "hostname": "ExampleHostname",
  "integration_key": {
    "secretKey": "9de5069c5afe602b2ea0a04b66beb2c0"
  },
  "secret_key": {
    "secretKey": "9de5069c5afe602b2ea0a04b66beb2c0"
  }
}
```

## Technical Details

### Actions


#### Auth

This action is used to perform second-factor authentication

##### Input

|Name|Type|Default|Required|Description|Enum|Example|Placeholder|Tooltip|
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
|async|bool|None|False|Set to true for an async response|None|False|None|None|
|device|string|auto|False|Device ID to use for auth|None|auto|None|None|
|factor|string|auto|False|Factor to use for authentication|["auto", "push", "passcode", "sms", "phone"]|auto|None|None|
|ipaddr|string|None|False|The IP address of the user to be authenticated, in dotted quad format. This will cause an 'allow' response to be sent if appropriate for requests from a trusted network|None|192.168.0.1|None|None|
|options|object|None|False|Additional options required by the API. This field is used to specify additional parameters that may be necessary depending on the authentication factor selected. Accepts the following parameters in JSON format `username`, `passcode`, `pushinfo`, `type`|None|{"type":"Transfer","pushinfo":{"hello":"world","host":"suspicious-host"}}|None|None|
|user_id|string|None|False|Permanent, unique identifier for the user as generated by Duo upon user creation. Exactly one of user_id or username must be specified|None|DUYHV6TJBC3O4RITS1WC|None|None|
|username|string|None|False|Unique identifier for the user that is commonly specified by your application during user creation. This value may also represent a username alias assigned to a user. Exactly one of user_id or username must be specified|None|user@example.com|None|None|
  
Example input:

```
{
  "async": false,
  "device": "auto",
  "factor": "auto",
  "ipaddr": "192.168.0.1",
  "options": {
    "pushinfo": {
      "hello": "world",
      "host": "suspicious-host"
    },
    "type": "Transfer"
  },
  "user_id": "DUYHV6TJBC3O4RITS1WC",
  "username": "user@example.com"
}
```

##### Output

|Name|Type|Required|Description|Example|
| :--- | :--- | :--- | :--- | :--- |
|result|string|False|Either "allow" or "deny". If "allow" was returned, your application should grant access to the user. If "deny", it should not|allow|
|status|string|False|String detailing the progress or outcome of the authentication attempt|allow|
|status_msg|string|False|The message describing the status of the authentication attempt. If the authentication attempt was denied, it may identify a reason|Success. Logging you in...|
|trusted_device_token|string|False|A string containing a token for that trusted device|REkxS00Ld4ddEVTRZOUlYMEldJ05HwUldRRThJR1VTNE0=|35|835c28ca9b042e05e|
|txid|string|False|A transaction ID|45f7c92b-f45f-4862-8545-e0f58e78075a|
  
Example output:

```
{
  "result": "allow",
  "status": "allow",
  "status_msg": "Success. Logging you in...",
  "trusted_device_token": "REkxS00Ld4ddEVTRZOUlYMEldJ05HwUldRRThJR1VTNE0=|35|835c28ca9b042e05e",
  "txid": "45f7c92b-f45f-4862-8545-e0f58e78075a"
}
```
### Triggers
  
*This plugin does not contain any triggers.*
### Tasks
  
*This plugin does not contain any tasks.*

### Custom Types
  
*This plugin does not contain any custom output types.*

## Troubleshooting
  
*This plugin does not contain a troubleshooting.*

# Version History

* 1.0.5 - Updated dependencies and SDK to the latest version (6.4.1)
* 1.0.4 - Updated dependencies and SDK to the latest version
* 1.0.3 - Upgraded `duo_client` in requirements.txt to version `4.0.0` | Upgraded `duo_client` in vendor folder to version `4.0.0` | Use input and output constants |  Change docker image from `komand/python-3-plugin:2` to `komand/python-3-37-slim-plugin:3` to reduce plugin image size
* 1.0.2 - New spec and help.md format for the Extension Library
* 1.0.1 - Support `type` parameter as `push_type` in the `options` input of the Auth action
* 1.0.0 - Update to v2 Python plugin architecture | Support web server mode | Update to new credential types | Add example output
* 0.1.1 - SSL bug fix in SDK
* 0.1.0 - Initial plugin

# Links

* [Duo](https://duo.com/)

## References

* [Duo](https://duo.com/)
* [Duo Auth API V2](https://duo.com/docs/authapi)