#!/usr/bin/env python
# GENERATED BY INSIGHT-PLUGIN - DO NOT EDIT
import os
import json
from sys import argv

Name = "Rapid7 InsightVM Console"
Vendor = "rapid7"
Version = "8.0.14"
Description = "InsightVM is a powerful vulnerability management tool which finds, prioritizes, and remediates vulnerabilities. This plugin uses an orchestrator to get top remediations, scan results and start scans"


def main():
    if 'http' in argv:
        if os.environ.get("GUNICORN_CONFIG_FILE"):
            with open(os.environ.get("GUNICORN_CONFIG_FILE")) as gf:
                gunicorn_cfg = json.load(gf)
                if gunicorn_cfg.get("worker_class", "sync") == "gevent":
                    from gevent import monkey
                    monkey.patch_all()
        elif 'gevent' in argv:
            from gevent import monkey
            monkey.patch_all()

    import insightconnect_plugin_runtime
    from komand_rapid7_insightvm import connection, actions, triggers, tasks

    class ICONRapid7Insightvm(insightconnect_plugin_runtime.Plugin):
        def __init__(self):
            super(self.__class__, self).__init__(
                name=Name,
                vendor=Vendor,
                version=Version,
                description=Description,
                connection=connection.Connection()
            )
            self.add_trigger(triggers.NewScans())
        
            self.add_trigger(triggers.NewExceptionRequest())
        
            self.add_trigger(triggers.ScanCompletion())
        
            self.add_action(actions.Scan())
        
            self.add_action(actions.GetScan())
        
            self.add_action(actions.GetSiteAssets())
        
            self.add_action(actions.GetScanAssets())
        
            self.add_action(actions.GetAssetVulnerabilities())
        
            self.add_action(actions.GetAssetSoftware())
        
            self.add_action(actions.DownloadReport())
        
            self.add_action(actions.ListReports())
        
            self.add_action(actions.GetVulnerabilityAffectedAssets())
        
            self.add_action(actions.CreateTag())
        
            self.add_action(actions.DeleteTag())
        
            self.add_action(actions.GetTags())
        
            self.add_action(actions.GetTag())
        
            self.add_action(actions.GetTagSites())
        
            self.add_action(actions.GetTagAssets())
        
            self.add_action(actions.GetTagAssetGroups())
        
            self.add_action(actions.RemoveAssetTag())
        
            self.add_action(actions.RemoveAssetGroupTags())
        
            self.add_action(actions.RemoveTagAssetGroups())
        
            self.add_action(actions.RemoveTagSites())
        
            self.add_action(actions.RemoveTagSearchCriteria())
        
            self.add_action(actions.TagSite())
        
            self.add_action(actions.TagAsset())
        
            self.add_action(actions.TagAssets())
        
            self.add_action(actions.TagAssetGroup())
        
            self.add_action(actions.UpdateTagSearchCriteria())
        
            self.add_action(actions.AssetSearch())
        
            self.add_action(actions.GetAsset())
        
            self.add_action(actions.GetAssetTags())
        
            self.add_action(actions.GetSites())
        
            self.add_action(actions.GetSite())
        
            self.add_action(actions.CreateSite())
        
            self.add_action(actions.UpdateSite())
        
            self.add_action(actions.UpdateSiteIncludedTargets())
        
            self.add_action(actions.UpdateSiteExcludedTargets())
        
            self.add_action(actions.UpdateSiteIncludedAssetGroups())
        
            self.add_action(actions.UpdateSiteExcludedAssetGroups())
        
            self.add_action(actions.DeleteSite())
        
            self.add_action(actions.GetAssetGroups())
        
            self.add_action(actions.GetAssetGroup())
        
            self.add_action(actions.CreateAssetGroup())
        
            self.add_action(actions.DeleteAssetGroup())
        
            self.add_action(actions.UpdateAssetGroupSearchCriteria())
        
            self.add_action(actions.GetVulnerabilitiesByCve())
        
            self.add_action(actions.GetScans())
        
            self.add_action(actions.UpdateScanStatus())
        
            self.add_action(actions.GenerateSharedSecret())
        
            self.add_action(actions.GetScanEngines())
        
            self.add_action(actions.GetScanEngine())
        
            self.add_action(actions.CreateScanEngine())
        
            self.add_action(actions.DeleteScanEngine())
        
            self.add_action(actions.GetScanEnginePools())
        
            self.add_action(actions.GetScanEnginePool())
        
            self.add_action(actions.CreateScanEnginePool())
        
            self.add_action(actions.AddScanEnginePoolEngine())
        
            self.add_action(actions.RemoveScanEnginePoolEngine())
        
            self.add_action(actions.DeleteScanEnginePool())
        
            self.add_action(actions.UpdateSiteScanEngine())
        
            self.add_action(actions.GetAuthenticationSources())
        
            self.add_action(actions.GetAuthenticationSource())
        
            self.add_action(actions.GetRoles())
        
            self.add_action(actions.GetRole())
        
            self.add_action(actions.GetUsers())
        
            self.add_action(actions.GetUser())
        
            self.add_action(actions.CreateUser())
        
            self.add_action(actions.UpdateUser())
        
            self.add_action(actions.DeleteUser())
        
            self.add_action(actions.DisableUser())
        
            self.add_action(actions.EnableUser())
        
            self.add_action(actions.UpdateUserRole())
        
            self.add_action(actions.UpdateUserAssetGroupAccess())
        
            self.add_action(actions.AddUserAssetGroupAccess())
        
            self.add_action(actions.RemoveUserAssetGroupAccess())
        
            self.add_action(actions.UpdateUserSiteAccess())
        
            self.add_action(actions.AddUserSiteAccess())
        
            self.add_action(actions.RemoveUserSiteAccess())
        
            self.add_action(actions.TopRemediations())
        
            self.add_action(actions.GenerateAdhocSqlReport())
        
            self.add_action(actions.ReviewException())
        
            self.add_action(actions.DeleteException())
        
            self.add_action(actions.CreateException())
        
            self.add_action(actions.GetVulnerability())
        
            self.add_action(actions.GetAssetGroupAssets())
        
            self.add_action(actions.DeleteAsset())
        
            self.add_action(actions.ListInactiveAssets())
        
            self.add_action(actions.GetExpiringVulnerabilityExceptions())
        
            self.add_action(actions.UpdateVulnerabilityExceptionExpirationDate())
        
            self.add_action(actions.AssetVulnerabilitySolution())
        
            self.add_action(actions.UpdateSharedCredential())
        

    """Run plugin"""
    cli = insightconnect_plugin_runtime.CLI(ICONRapid7Insightvm())
    cli.run()


if __name__ == "__main__":
    main()
