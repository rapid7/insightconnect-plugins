#!/usr/bin/env python
# GENERATED BY INSIGHT-PLUGIN - DO NOT EDIT
import os
import json
from sys import argv

Name = "ServiceNow"
Vendor = "rapid7"
Version = "8.1.3"
Description = "[ServiceNow](https://www.servicenow.com/) is a tool for managing incidents and configuration management. This plugin allows users to manage all aspects of incidents including creation, search, and updates. Additionally, incident changes can be monitored and processed for use in a Rapid7 InsightConnect workflow.Note: This plugin affects only the underlying tables in a ServiceNow instance, not its UI. Hence, this plugin will work seamlessly with Virtual Task Boards"


def main():
    if 'http' in argv:
        if os.environ.get("GUNICORN_CONFIG_FILE"):
            with open(os.environ.get("GUNICORN_CONFIG_FILE")) as gf:
                gunicorn_cfg = json.load(gf)
                if gunicorn_cfg.get("worker_class", "sync") == "gevent":
                    from gevent import monkey
                    monkey.patch_all()
        elif 'gevent' in argv:
            from gevent import monkey
            monkey.patch_all()

    import insightconnect_plugin_runtime
    from icon_servicenow import connection, actions, triggers, tasks

    class ICONServicenow(insightconnect_plugin_runtime.Plugin):
        def __init__(self):
            super(self.__class__, self).__init__(
                name=Name,
                vendor=Vendor,
                version=Version,
                description=Description,
                connection=connection.Connection()
            )
            self.add_trigger(triggers.IncidentChanged())
        
            self.add_trigger(triggers.IncidentCreated())
        
            self.add_trigger(triggers.VulnerabilityUpdated())
        
            self.add_action(actions.CreateChangeRequest())
        
            self.add_action(actions.CreateIncident())
        
            self.add_action(actions.SearchIncident())
        
            self.add_action(actions.ReadIncident())
        
            self.add_action(actions.UpdateIncident())
        
            self.add_action(actions.DeleteIncident())
        
            self.add_action(actions.PutIncidentAttachment())
        
            self.add_action(actions.SearchIncidentAttachment())
        
            self.add_action(actions.GetIncidentAttachment())
        
            self.add_action(actions.DeleteIncidentAttachment())
        
            self.add_action(actions.GetCi())
        
            self.add_action(actions.SearchCi())
        
            self.add_action(actions.CreateCi())
        
            self.add_action(actions.UpdateCi())
        
            self.add_action(actions.GetIncidentCommentsWorknotes())
        
            self.add_action(actions.GetAttachmentsForAnIncident())
        
            self.add_action(actions.CreateVulnerability())
        
            self.add_action(actions.GetVulnerability())
        
            self.add_action(actions.UpdateVulnerability())
        
            self.add_action(actions.DeleteVulnerability())
        
            self.add_action(actions.GetSecurityIncident())
        
            self.add_action(actions.DeleteSecurityIncident())
        
            self.add_action(actions.SearchSecurityIncident())
        
            self.add_action(actions.CreateSecurityIncident())
        
            self.add_action(actions.UpdateSecurityIncident())
        

    """Run plugin"""
    cli = insightconnect_plugin_runtime.CLI(ICONServicenow())
    cli.run()


if __name__ == "__main__":
    main()
