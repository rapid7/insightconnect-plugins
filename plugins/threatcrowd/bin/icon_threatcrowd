#!/usr/bin/env python
# GENERATED BY KOMAND SDK - DO NOT EDIT
import os
import json
from sys import argv

Name = "Threat Crowd"
Vendor = "rapid7"
Version = "4.0.0"
Description = "Threat Crowd is an open source search engine for threats. Using the Threat Crowd plugin for Rapid7 InsightConnect, users can search by domain, IP address, email address, and other information to discover threats"


def main():
    if 'http' in argv:
        if os.environ.get("GUNICORN_CONFIG_FILE"):
            with open(os.environ.get("GUNICORN_CONFIG_FILE")) as gf:
                gunicorn_cfg = json.load(gf)
                if gunicorn_cfg.get("worker_class", "sync") == "gevent":
                    from gevent import monkey
                    monkey.patch_all()
        elif 'gevent' in argv:
            from gevent import monkey
            monkey.patch_all()

    import insightconnect_plugin_runtime
    from icon_threatcrowd import connection, actions, triggers

    class ICONThreatcrowd(insightconnect_plugin_runtime.Plugin):
        def __init__(self):
            super(self.__class__, self).__init__(
                name=Name,
                vendor=Vendor,
                version=Version,
                description=Description,
                connection=connection.Connection()
            )
            self.add_action(actions.Address())

            self.add_action(actions.Av())

            self.add_action(actions.Domain())

            self.add_action(actions.Email())

            self.add_action(actions.Hash())

            self.add_action(actions.Votes())


    """Run plugin"""
    cli = insightconnect_plugin_runtime.CLI(ICONThreatcrowd())
    cli.run()


if __name__ == "__main__":
    main()
