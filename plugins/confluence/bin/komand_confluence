#!/usr/bin/env python
# GENERATED BY INSIGHT-PLUGIN - DO NOT EDIT
import os
import json
from sys import argv

Name = "Confluence"
Vendor = "rapid7"
Version = "2.0.1"
Description = "Confluence is an open and shared workspace for managing documents and files within an organization. Using the Confluence plugin for Rapid7 InsightConnect, users can view and update pages dynamically within automation workflows"


def main():
    if 'http' in argv:
        if os.environ.get("GUNICORN_CONFIG_FILE"):
            with open(os.environ.get("GUNICORN_CONFIG_FILE")) as gf:
                gunicorn_cfg = json.load(gf)
                if gunicorn_cfg.get("worker_class", "sync") == "gevent":
                    from gevent import monkey
                    monkey.patch_all()
        elif 'gevent' in argv:
            from gevent import monkey
            monkey.patch_all()

    import insightconnect_plugin_runtime
    from komand_confluence import connection, actions, triggers, tasks

    class ICONConfluence(insightconnect_plugin_runtime.Plugin):
        def __init__(self):
            super(self.__class__, self).__init__(
                name=Name,
                vendor=Vendor,
                version=Version,
                description=Description,
                connection=connection.Connection()
            )
            self.add_action(actions.GetPageContent())
        
            self.add_action(actions.GetPageContentById())
        
            self.add_action(actions.StorePageContent())
        
            self.add_action(actions.GetPage())
        
            self.add_action(actions.GetPageById())
        

    """Run plugin"""
    cli = insightconnect_plugin_runtime.CLI(ICONConfluence())
    cli.run()


if __name__ == "__main__":
    main()
