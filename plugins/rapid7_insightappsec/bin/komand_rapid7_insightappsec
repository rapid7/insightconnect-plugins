#!/usr/bin/env python
# GENERATED BY INSIGHT-PLUGIN - DO NOT EDIT
import os
import json
from sys import argv

Name = "Rapid7 InsightAppSec"
Vendor = "rapid7"
Version = "1.2.1"
Description = "DAST capabilities and InsightConnects automation prowess can help you simplify your SDLC Process with this scan management plugin. The need for automation becomes paramount in the fast moving landscape of modern web scanning and automating you web app scanning with this plugin can save you loads of time to allow you to focus on remediating issues to get your app into product faster!"


def main():
    if 'http' in argv:
        if os.environ.get("GUNICORN_CONFIG_FILE"):
            with open(os.environ.get("GUNICORN_CONFIG_FILE")) as gf:
                gunicorn_cfg = json.load(gf)
                if gunicorn_cfg.get("worker_class", "sync") == "gevent":
                    from gevent import monkey
                    monkey.patch_all()
        elif 'gevent' in argv:
            from gevent import monkey
            monkey.patch_all()

    import insightconnect_plugin_runtime
    from komand_rapid7_insightappsec import connection, actions, triggers, tasks

    class ICONRapid7Insightappsec(insightconnect_plugin_runtime.Plugin):
        def __init__(self):
            super(self.__class__, self).__init__(
                name=Name,
                vendor=Vendor,
                version=Version,
                description=Description,
                connection=connection.Connection()
            )
            self.add_trigger(triggers.NewVulnerabilities())
        
            self.add_action(actions.CreateScanConfig())
        
            self.add_action(actions.GetScanConfig())
        
            self.add_action(actions.UpdateScanConfig())
        
            self.add_action(actions.DeleteScanConfig())
        
            self.add_action(actions.GetScanConfigs())
        
            self.add_action(actions.SubmitScan())
        
            self.add_action(actions.GetScan())
        
            self.add_action(actions.GetScans())
        
            self.add_action(actions.DeleteScan())
        
            self.add_action(actions.SubmitScanAction())
        
            self.add_action(actions.GetScanEngineEvents())
        
            self.add_action(actions.GetScanExecutionDetails())
        
            self.add_action(actions.GetScanPlatformEvents())
        
            self.add_action(actions.GetVulnerability())
        
            self.add_action(actions.GetVulnerabilities())
        
            self.add_action(actions.CreateSchedule())
        
            self.add_action(actions.GetVulnerabilityDiscovery())
        
            self.add_action(actions.GetVulnerabilityDiscoveries())
        

    """Run plugin"""
    cli = insightconnect_plugin_runtime.CLI(ICONRapid7Insightappsec())
    cli.run()


if __name__ == "__main__":
    main()
