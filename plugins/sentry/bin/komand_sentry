#!/usr/bin/env python
# GENERATED BY KOMAND SDK - DO NOT EDIT
import os
import json
from sys import argv

Name = "Sentry"
Vendor = "rapid7"
Version = "1.0.2"
Description = "Sentry is an open source error tracking tool that helps developers monitor and fix crashes in real time. Users can manage issues and events with the Sentry plugin for Rapid7 InsightConnect"


def main():
    if 'http' in argv:
        if os.environ.get("GUNICORN_CONFIG_FILE"):
            with open(os.environ.get("GUNICORN_CONFIG_FILE")) as gf:
                gunicorn_cfg = json.load(gf)
                if gunicorn_cfg.get("worker_class", "sync") == "gevent":
                    from gevent import monkey
                    monkey.patch_all()
        elif 'gevent' in argv:
            from gevent import monkey
            monkey.patch_all()

    import komand
    from komand_sentry import connection, actions, triggers

    class ICONSentry(komand.Plugin):
        def __init__(self):
            super(self.__class__, self).__init__(
                name=Name,
                vendor=Vendor,
                version=Version,
                description=Description,
                connection=connection.Connection()
            )
            self.add_action(actions.ListIssueEvents())

            self.add_action(actions.ListProjectIssues())

            self.add_action(actions.SubmitEvent())

            self.add_action(actions.UpdateIssue())


    """Run plugin"""
    cli = komand.CLI(ICONSentry())
    cli.run()


if __name__ == "__main__":
    main()
