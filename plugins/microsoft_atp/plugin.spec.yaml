plugin_spec_version: v2
extension: plugin
products: [insightconnect]
name: microsoft_atp
title: Microsoft Defender for Endpoint
description: The Microsoft Defender for Endpoint plugin allows Rapid7 InsightConnect
  users to quickly take remediation actions across their organization. This plugin
  can isolate machines, run virus scans, and quarantine files
version: 6.0.3
connection_version: 6
supported_versions: ['2024-05-21']
vendor: rapid7
support: community
cloud_ready: true
fedramp_ready: true
status: []
resources:
  vendor_url: https://www.microsoft.com/
  docs_url: https://docs.rapid7.com/insightconnect/microsoft-defender-ATP
  source_url: https://github.com/rapid7/insightconnect-plugins/tree/master/plugins/microsoft_atp
tags:
- windows
- atp
- microsoft
- defender
hub_tags:
  use_cases: [threat_detection_and_response, user_management, alerting_and_notifications,
    devops]
  keywords: [windows, atp, microsoft, defender, cloud_enabled]
  features: []
sdk:
  type: full
  version: 6.3.3
  user: nobody
troubleshooting:
- For information on how to setup your Azure application and assign permissions go
  [here](https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/exposed-apis-create-app-webapp)
links:
- '[Windows Defender for Endpoint](https://www.microsoft.com/en-us/security/business/endpoint-security/microsoft-defender-endpoint)'
references:
- '[Windows Defender for Endpoint API Start Page](https://learn.microsoft.com/en-us/defender-endpoint/api/apis-intro)'
- '[Windows Defender for Endpoint API Endpoints](https://learn.microsoft.com/en-us/defender-endpoint/api/exposed-apis-list)'
version_history:
- 6.0.3 - Updated SDK to the latest version (6.3.3)
- 6.0.2 - Updated SDK to the latest version (6.2.5)
- 6.0.1 - Update to latest SDK (v6.2.2) | Address vulnerabilities | Rebrand to `Microsoft
  Defender for Endpoint`
- 6.0.0 - Updated SDK to the latest version | Initial updates for fedramp compliance
- '5.2.0 - Add new action: Update Alert'
- 5.1.0 - Adding the following as new action types to `blacklist` action ['Warn',
  'Block', 'Audit'] | Add a new flag in the `blacklist` action to toggle generateAlerts
  flag | Bump SDK to version 5.4.9
- 5.0.0 - Updated the SDK version | Cloud enabled | fixed bug when machine_id is used
  for find_first_machine
- 4.8.1 - Fixed a problem where some actions could not find the machine
- 4.8.0 - Add Evidence output for Get Alerts trigger and Get Alert Matching Key trigger
- 4.7.1 - Fix bug in Get Alerts trigger which caused trigger to crash
- 4.7.0 - Add new action Collect Investigation Package
- 4.6.0 - Add new actions Get Installed Software, Get Related Machines and Manage
  Tags
- 4.5.1 - Add `docs_url` to plugin spec with link to [plugin setup guide](https://docs.rapid7.com/insightconnect/microsoft-defender-ATP)
- 4.5.0 - Add new action Get Missing Software Updates
- 4.4.1 - Add validation MD5 hash in Blacklist action | Set default value for Title,
  Expiration Time and Description input in action Blacklist
- 4.4.0 - Add new action Get Security Recommendations
- 4.3.0 - Add new action Get Machine Vulnerabilities
- 4.2.0 - Add new action Blacklist
- 4.1.0 - Add new action Find Machines with Installed Software
- 4.0.0 - Add custom type to output in action Get Machine Information
- 3.0.0 - Move connection functions to their own util class | Changed `Exception`
  to `PluginException` | Added error handling around "Action already in progress"
  state in Isolate Machine, Unisolate Machine, Stop and Quarantine File, and Run Antivirus
  Scan actions | Rename `machine_id` to `machine` in machine-related actions to support
  hostnames and IP addresses in addition to machine IDs.
- 2.0.0 - Update to refactor connection and actions
- 1.5.1 - New spec and help.md format for the Extension Library
- 1.5.0 - Fix issue where triggers always returned a blank payload
- 1.4.0 - New trigger Get Alerts | New action Get Machine Action
- 1.3.0 - New actions Stop and Quarantine File and Run Antivirus Scan
- 1.2.0 - New action Get File IDs from Alert
- 1.1.0 - New actions Get Machine ID from Alert, Isolate Machine, and Unisolate Machine
- 1.0.0 - Initial plugin
key_features:
- Trigger workflows on new security alerts
- Manage isolation of network resources
- Start virus scans
- Stop execution of malicious code
requirements:
- Windows Defender Advanced Threat Protection application credentials
types:
  manage_tags_response:
    '@odata.context':
      title: '@Odata.Context'
      type: string
      description: '@odata.context'
      required: false
    agentVersion:
      title: Agent Version
      type: string
      description: Agent version
      required: false
    computerDnsName:
      title: Computer DNS Name
      type: string
      description: Computer DNS name
      required: false
    deviceValue:
      title: Device Value
      type: string
      description: Device value
      required: false
    exposureLevel:
      title: Exposure Level
      type: string
      description: Exposure level
      required: false
    firstSeen:
      title: First Seen
      type: string
      description: First seen
      required: false
    healthStatus:
      title: Health Status
      type: string
      description: Health status
      required: false
    id:
      title: ID
      type: string
      description: ID
      required: false
    isAadJoined:
      title: Is AAD Joined
      type: boolean
      description: Is AAD joined
      required: false
    lastExternalIpAddress:
      title: Last External IP Address
      type: string
      description: Last external IP address
      required: false
    lastIpAddress:
      title: Last IP Address
      type: string
      description: Last IP address
      required: false
    lastSeen:
      title: Last Seen
      type: string
      description: Last seen
      required: false
    machineTags:
      title: Machine Tags
      type: '[]string'
      description: Machine tags
      required: false
    osBuild:
      title: OS Build
      type: integer
      description: OS build
      required: false
    osPlatform:
      title: OS Platform
      type: string
      description: OS platform
      required: false
    osProcessor:
      title: OS Processor
      type: string
      description: OS Processor
      required: false
    rbacGroupId:
      title: RBAC Group ID
      type: integer
      description: RBAC group ID
      required: false
    riskScore:
      title: Risk Score
      type: string
      description: Risk score
      required: false
    version:
      title: Version
      type: string
      description: Version
      required: false
  software:
    activeAlert:
      title: Active Alert
      type: boolean
      description: Active alert
      required: false
    exposedMachines:
      title: Exposed Machines
      type: integer
      description: Exposed machines
      required: false
    id:
      title: ID
      type: string
      description: ID
      required: false
    impactScore:
      title: Impact Score
      type: float
      description: Impact score
      required: false
    name:
      title: Name
      type: string
      description: Name
      required: false
    publicExploit:
      title: Public Exploit
      type: boolean
      description: Public exploit
      required: false
    vendor:
      title: Vendor
      type: string
      description: Vendor
      required: false
    weaknesses:
      title: Weaknesses
      type: integer
      description: Weaknesses
      required: false
  related_user_object:
    domainName:
      title: Domain Name
      description: Domain name
      required: false
      type: string
    userName:
      title: User Name
      description: User name
      required: false
      type: string
  evidence:
    entityType:
      title: Entity Type
      description: Type of evidence
      required: false
      type: string
    evidenceCreationTime:
      title: Evidence Creation Time
      description: Creation time of evidence in ISO 8601 format
      required: false
      type: string
    sha1:
      title: SHA1
      description: SHA1 hash
      required: false
      type: string
    sha256:
      title: SHA256
      description: SHA256 hash
      required: false
      type: string
    filePath:
      title: File Path
      description: File Path
      required: false
      type: string
    fileName:
      title: File Name
      description: File Name
      required: false
      type: string
    processId:
      title: Process ID
      description: Process ID
      required: false
      type: integer
    processCommandLine:
      title: Process Command Line
      description: Process Command Line
      required: false
      type: string
    processCreationTime:
      title: Process Creation Time
      description: Process Creation Time in ISO 8601 format
      required: false
      type: string
    parentProcessID:
      title: Parent Process ID
      description: Parent process ID
      required: false
      type: integer
    parentProcessCreationTime:
      title: Parent Process Creation Time
      description: Parent Process Creation Time in ISO 8601 format
      required: false
      type: string
    parentProcessFileName:
      title: Parent Process File Name
      description: Parent Process File Name
      required: false
      type: string
    parentProcessFilePath:
      title: Parent Process File Path
      description: Parent Process File Path
      required: false
      type: string
    ipAddress:
      title: IP Address
      description: IP Address
      required: false
      type: string
    url:
      title: URL
      description: URL
      required: false
      type: string
    registryKey:
      title: Registry Key
      description: A key-level node in the Windows registry
      required: false
      type: string
    registryHive:
      title: Registry Hive
      description: Registry Hive
      required: false
      type: string
    registryValueType:
      title: Registry Value Type
      description: Registry Value Type
      required: false
      type: string
    registryValue:
      title: Registry Value
      description: Registry Value
      required: false
      type: string
    accountName:
      title: Account Name
      description: Account Name
      required: false
      type: string
    domainName:
      title: Domain Name
      description: Domain Name
      required: false
      type: string
    userSid:
      title: User SID
      description: User Secrurity ID
      required: false
      type: string
    aadUserId:
      title: AAD User ID
      description: Azure Active Directory User ID
      required: false
      type: string
    userPrincipalName:
      title: User Principal Name
      description: User Principal Name
      required: false
      type: string
    detectionStatus:
      title: Detection Status
      description: Detection Status
      required: false
      type: string
  alert:
    id:
      title: ID
      type: string
      description: ID
      required: false
    incidentId:
      title: Incident ID
      type: integer
      description: Incident ID
      required: false
    investigationId:
      title: Investigation ID
      type: integer
      description: Investigation ID
      required: false
    assignedTo:
      title: Assigned To
      type: string
      description: Assigned To
      required: false
    severity:
      title: Severity
      type: string
      description: Severity
      required: false
    status:
      title: Status
      type: string
      description: Status
      required: false
    classification:
      title: Classification
      type: string
      description: Classification
      required: false
    determination:
      title: Determination
      type: string
      description: Determination
      required: false
    investigationState:
      title: Investigation State
      type: string
      description: Investigation state
      required: false
    detectionSource:
      title: Detection Source
      type: string
      description: Detection source
      required: false
    category:
      title: Category
      type: string
      description: Category
      required: false
    threatFamilyName:
      title: Threat Family Name
      type: string
      description: Threat family name
      required: false
    title:
      title: Title
      type: string
      description: Title
      required: false
    description:
      title: Description
      type: string
      description: Description
      required: false
    alertCreationTime:
      title: Alert Creation Time
      type: string
      description: Alert creation time
      required: false
    firstEventTime:
      title: First Event Time
      type: string
      description: First event time
      required: false
    lastEventTime:
      title: Last Event Time
      type: string
      description: Last event time
      required: false
    lastUpdateTime:
      title: Last Update Time
      type: string
      description: Last update time
      required: false
    resolvedTime:
      title: Resolved Time
      type: string
      description: Resolved time
      required: false
    machineId:
      title: Machine ID
      type: string
      description: Machine ID
      required: false
    computerDnsName:
      title: Computer DNS Name
      type: string
      description: Computer DNS name
      required: false
    rbacGroupName:
      title: RBAC Group Name
      type: string
      description: RBAC group name
      required: false
    aadTenantId:
      title: AAD Tenant ID
      type: string
      description: AAD tenant ID
      required: false
    relatedUser:
      title: Related User
      type: related_user_object
      description: Related user
      required: false
    evidence:
      title: Evidence
      type: '[]evidence'
      description: List of related alert evidence
      required: false
  file_type:
    sha1:
      title: SHA1
      type: string
      description: SHA1
      required: false
    sha256:
      title: SHA256
      type: string
      description: SHA256
      required: false
    md5:
      title: MD5
      type: string
      description: MD5
      required: false
    globalPrevalence:
      title: Global Prevalence
      type: integer
      description: Global prevalence
      required: false
    globalFirstObserved:
      title: Global First Observed
      type: string
      description: Global first observed
      required: false
    globalLastObserved:
      title: Global Last Observed
      type: string
      description: Global last observed
      required: false
    size:
      title: Size
      type: integer
      description: Size
      required: false
    fileType:
      title: File Type
      type: string
      description: File type
      required: false
    isPeFile:
      title: Is PE File
      type: boolean
      description: Is PE File
      required: false
    filePublisher:
      title: File Publisher
      type: string
      description: File publisher
      required: false
    fileProductName:
      title: File Product Name
      type: string
      description: File product name
      required: false
    signer:
      title: Signer
      type: string
      description: Signer
      required: false
    issuer:
      title: Issuer
      type: string
      description: Issuer
      required: false
    signerHash:
      title: Signer Hash
      type: string
      description: Signer hash
      required: false
    isValidCertificate:
      title: Is Valid Certificate
      type: boolean
      description: Is valid certificate
      required: false
    determinationType:
      title: Determination Type
      type: string
      description: Determination type
      required: false
    determinationValue:
      title: Determination Value
      type: string
      description: Determination value
      required: false
  machine_software:
    id:
      title: ID
      type: string
      description: ID
      required: false
    computerDnsName:
      title: Computer DNS Name
      type: string
      description: Computer DNS name
      required: false
    osPlatform:
      title: OS Platform
      type: string
      description: OS platform
      required: false
    rbacGroupName:
      title: RBAC Group Name
      type: string
      description: RBAC group name
      required: false
    rbacGroupId:
      title: RBAC Group ID
      type: number
      description: RBAC group ID
      required: false
  machine:
    agentVersion:
      title: Agent Version
      type: string
      description: Agent version
      required: false
    computerDnsName:
      title: Computer DNS Name
      type: string
      description: Computer DNS name
      required: false
    exposureLevel:
      title: Exposure Level
      type: string
      description: Exposure level
      required: false
    firstSeen:
      title: First Seen
      type: string
      description: First seen
      required: false
    healthStatus:
      title: Health Status
      type: string
      description: Health status
      required: false
    id:
      title: ID
      type: string
      description: ID
      required: false
    lastExternalIpAddress:
      title: Last External IP Address
      type: string
      description: Last external IP address
      required: false
    lastIpAddress:
      title: Last IP Address
      type: string
      description: Last IP address
      required: false
    lastSeen:
      title: Last Seen
      type: string
      description: Last seen
      required: false
    osBuild:
      title: OS Build
      type: integer
      description: OS build
      required: false
    osPlatform:
      title: OS Platform
      type: string
      description: OS platform
      required: false
    osProcessor:
      title: OS Processor
      type: string
      description: OS processor
      required: false
    rbacGroupId:
      title: RBAC Group ID
      type: integer
      description: RBAC group ID
      required: false
    riskScore:
      title: Risk Score
      type: string
      description: Risk score
      required: false
    version:
      title: Version
      type: string
      description: Version
      required: false
    machineTags:
      title: Machine Tags
      type: '[]string'
      description: Machine Tags
      required: false
  machine_action:
    creationDateTimeUtc:
      title: Creation Date Time UTC
      type: string
      description: Creation date time UTC
      required: false
    errorHResult:
      title: Error HResult
      type: integer
      description: Error HResult
      required: false
    id:
      title: ID
      type: string
      description: ID
      required: false
    lastUpdateDateTimeUtc:
      title: Last Update Date Time UTC
      type: string
      description: Last update date time UTC
      required: false
    machineId:
      title: Machine ID
      type: string
      description: Machine ID
      required: false
    requestor:
      title: Requestor
      type: string
      description: Requestor
      required: false
    requestorComment:
      title: Requestor Comment
      type: string
      description: Requestor comment
      required: false
    status:
      title: Status
      type: string
      description: Status
      required: false
  indicator_action:
    '@odata.context':
      title: '@Odata.Context'
      type: string
      description: '@odata.context'
      required: false
    id:
      title: Indicator ID
      type: string
      description: Identity of the indicator entity
      required: false
    indicatorValue:
      title: Indicator Value
      type: string
      description: 'The potentially malicious indicator of one of the following types:
        IP addresses, URLs, domains, and SHA1 and SHA256 hashes'
      required: false
    indicatorType:
      type: string
      title: Indicator Type
      description: Type of the indicator
      example: Url
      required: false
    application:
      type: string
      title: Application
      description: The application associated with the indicator
      example: demo-test
      required: false
    action:
      type: string
      title: Action
      description: The action that will be taken if the indicator will be discovered
        in the organization
      example: AlertAndBlock
      required: false
    sourceType:
      type: string
      title: Source Type
      description: User in case the Indicator created by a user (e.g. from the portal),
        AadApp in case it submitted using automated application via the API.
      example: AadApp
      required: false
    source:
      type: string
      title: Source
      description: The name of the user/application that submitted the indicator
      example: test
      required: false
    createdBy:
      type: string
      title: Created By
      description: Unique identity of the user/application that submitted the indicator
      example: test
      required: false
    createdByDisplayName:
      title: Created By Display Name
      type: string
      description: Created by display name
      required: false
    createdBySource:
      title: Created By Source
      type: string
      description: Created by source
      required: false
    generateAlert:
      title: Generate Alert
      type: boolean
      description: Generate alert
      required: false
    historicalDetection:
      title: Historical Detection
      type: boolean
      description: Historical detection
      required: false
    lastUpdatedBy:
      type: string
      title: Last Updated By
      description: Identity of the user/application that last updated the indicator
      required: false
      example: 82f42fca-e931-4f03-b54c-47af94bd394d
    mitreTechniques:
      title: MITRE Techniques
      type: '[]string'
      description: MITRE techniques
      required: false
    creationTimeDateTimeUtc:
      type: string
      title: Creation Time
      description: The date and time when the indicator was created
      required: false
    expirationTime:
      type: string
      title: Expiration Time
      description: The expiration time of the indicator
      required: false
    lastUpdateTime:
      type: string
      title: Last Update Time
      description: The last time the indicator was updated
      required: false
    severity:
      type: string
      title: Severity
      description: The severity of the indicator
      required: false
    title:
      type: string
      title: Title
      description: Indicator alert title
      required: false
    description:
      type: string
      title: Description
      description: Description of the indicator
      required: false
    recommendedActions:
      type: string
      title: Recommended Actions
      description: Recommended actions for the indicator
      required: false
    rbacGroupIds:
      title: RBAC Group IDs
      type: '[]string'
      description: RBAC group IDs
      required: false
    rbacGroupNames:
      type: '[]string'
      title: RBAC Group Names
      description: RBAC device group names where the indicator is exposed and active.
        Empty list in case it exposed to all devices
      required: false
  vulnerability:
    cvssV3:
      title: CVSS V3
      type: float
      description: CVSS v3
      required: false
    description:
      title: Description
      type: string
      description: Description
      required: false
    exploitInKit:
      title: Exploit In Kit
      type: boolean
      description: Exploit in kit
      required: false
    exploitTypes:
      title: Exploit Types
      type: '[]string'
      description: Exploit types
      required: false
    exploitUris:
      title: Exploit URIs
      type: '[]string'
      description: Exploit URIs
      required: false
    exploitVerified:
      title: Exploit Verified
      type: boolean
      description: Exploit verified
      required: false
    exposedMachines:
      title: Exposed Machines
      type: integer
      description: Exposed machines
      required: false
    id:
      title: ID
      type: string
      description: ID
      required: false
    name:
      title: Name
      type: string
      description: Name
      required: false
    publicExploit:
      title: Public Exploit
      type: boolean
      description: Public exploit
      required: false
    publishedOn:
      title: Published On
      type: string
      description: Published on
      required: false
    severity:
      title: Severity
      type: string
      description: Severity
      required: false
    updatedOn:
      title: Updated On
      type: string
      description: Updated on
      required: false
  recommendation:
    activeAlert:
      title: Active Alert
      description: Active alert
      type: boolean
      required: false
    associatedThreats:
      title: Associated Threats
      description: Associated threats
      type: '[]string'
      required: false
    configScoreImpact:
      title: Config Score Impact
      description: Config score impact
      type: float
      required: false
    exposedMachinesCount:
      title: Exposed Machines Count
      description: Exposed machines count
      type: integer
      required: false
    exposureImpact:
      title: Exposure Impact
      description: Exposure impact
      type: float
      required: false
    id:
      title: ID
      description: ID
      type: string
      required: false
    nonProductivityImpactedAssets:
      title: Non Productivity Impacted Assets
      description: Non productivity impacted assets
      type: integer
      required: false
    productName:
      title: Product Name
      description: Product name
      type: string
      required: false
    publicExploit:
      title: Public Exploit
      description: Public exploit
      type: boolean
      required: false
    recommendationCategory:
      title: Recommendation Category
      description: Recommendation category
      type: string
      required: false
    recommendationName:
      title: Recommendation Name
      description: Recommendation name
      type: string
      required: false
    relatedComponent:
      title: Related Component
      description: Related component
      type: string
      required: false
    remediationType:
      title: Remediation Type
      description: Remediation type
      type: string
      required: false
    severityScore:
      title: Severity Score
      description: Severity score
      type: float
      required: false
    status:
      title: Status
      description: Status
      type: string
      required: false
    totalMachineCount:
      title: Total Machine Count
      description: Total machine count
      type: integer
      required: false
    vendor:
      title: Vendor
      description: Vendor
      type: string
      required: false
    weaknesses:
      title: Weaknesses
      description: Weaknesses
      type: integer
      required: false
  update:
    id:
      title: ID
      description: Update ID
      type: string
      required: false
    name:
      title: Name
      description: Update name
      type: string
      required: false
    osBuild:
      title: OS Build
      description: Update OS build
      type: integer
      required: false
    productsNames:
      title: Products Names
      description: Update products names
      type: '[]string'
      required: false
    url:
      title: URL
      description: Update URL
      type: string
      required: false
    machineMissedOn:
      title: Machine Missed On
      description: Update machine missed on
      type: integer
      required: false
    cveAddressed:
      title: CVE Addressed
      description: Update CVE addressed
      type: integer
      required: false


connection:
  application_id:
    title: Application ID
    description: Application (client) ID
    type: string
    required: true
    example: a74dfb10-i33o-44e1-ba87-5fn2bb4e6b4d
    order: 1
  application_secret:
    title: Application Secret
    description: Application secret
    type: credential_secret_key
    required: true
    example: kQDFcZoJYmxJpiS1x7rdyleyNFwhvLgcOZCkYG+5=
    order: 2
  directory_id:
    title: Directory ID
    description: Directory (tenant) ID
    type: string
    required: true
    example: 3a522933-ae5e-2b63-96ab-3c004b4f7f10
    order: 3
  endpoint:
    title: Endpoint
    description: 'The type of endpoint to connect to: normal service, GCC (government),
      GCC High (government), DoD (military)'
    type: string
    required: true
    example: Normal
    enum:
    - Normal
    - GCC
    - GCC High
    - DoD
    order: 4

actions:
  get_machine_information:
    title: Get Machine Information
    description: Get details about a machine with its ID
    input:
      machine:
        title: Machine
        description: Machine IP address, hostname and machine ID
        type: string
        example: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73
        required: true
    output:
      machine:
        title: Machine
        description: Machine information
        type: machine
        required: true
        example: {'@odata.context': https://api.securitycenter.windows.com/api/$metadata#Machines/$entity,
          id: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73, computerDnsName: desktop-qo15on7,
          firstSeen: '2020-06-26T19:54:48.0962745Z', lastSeen: '2020-07-02T18:34:23.1871866Z',
          osPlatform: Windows10, osProcessor: x64, version: '2004', lastIpAddress: 198.51.100.100,
          lastExternalIpAddress: 198.51.100.100, agentVersion: 10.7150.19041.153,
          osBuild: 19041, healthStatus: Active, rbacGroupId: 0, riskScore: Medium,
          exposureLevel: Low, machineTags: []}
  get_file_id_from_alert_id:
    title: Get Files from Alert
    description: Retrieve a list of file information objects related to an alert
    input:
      alert_id:
        type: string
        title: Alert ID
        description: Alert ID to get files from
        example: da637293198146839977_2089064327
        required: true
    output:
      file_list:
        title: File Information
        description: The file ID related to the given alert ID
        type: '[]file_type'
        required: true
        example: [{sha1: f093e7767bb63ac973b697d3fd1d40a78b87b8bf, sha256: 470a75fe3da2ddf9d27fb3f9c96e6c665506ea7ba26ab89f0c89606f678ae4a2,
            md5: a69acb01b99959efec7c0a2a8caa7545, globalPrevalence: 437, globalFirstObserved: '2015-11-01T02:48:27.1103102Z',
            globalLastObserved: '2020-07-05T07:58:26.8760293Z', size: 740544, isPeFile: true,
            signerHash: 006276223396f7510653e20f0d10cd1a5d97176e, isValidCertificate: false,
            determinationType: Unknown, determinationValue: HackTool:MSIL/AutoKms}]
  isolate_machine:
    title: Isolate Machine
    description: Isolate a machine from the network
    input:
      machine:
        title: Machine
        description: Machine IP address, hostname and machine ID
        type: string
        example: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73
        required: true
      isolation_type:
        type: string
        description: Type of isolation to perform on target machine
        title: Isolation Type
        required: true
        example: Full
        enum:
        - Full
        - Selective
      comment:
        type: string
        title: Comment
        description: Comment to associate with the isolation action
        example: Isolated by InsightConnect
        required: true
    output:
      machine_isolation_response:
        type: machine_action
        title: Machine Action Response
        description: A response that includes the result of the action, and supplemental
          information about the action taken
        required: true
        example: {'@odata.context': https://api.securitycenter.windows.com/api/$metadata#MachineActions/$entity,
          id: b89eb834-4578-496c-8be0-03f004061435, type: Isolate, requestor: user@example.com,
          requestorComment: Isolate machine due to alert 1234, status: InProgress,
          machineId: 1e5bc9d7e413ddd7902c2932e418702b84d0cc07, creationDateTimeUtc: '2017-12-04T12:12:18.9725659Z',
          lastUpdateTimeUtc: '2017-12-04T12:12:18.9725659Z', relatedFileInfo: null}
  unisolate_machine:
    title: Unisolate Machine
    description: Restore network connectivity to a machine
    input:
      machine:
        title: Machine
        description: Machine IP address, hostname and machine ID
        type: string
        example: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73
        required: true
      comment:
        type: string
        title: Comment
        description: Comment to associate with the unisolate action
        example: Unisolated by InsightConnect
        required: true
    output:
      machine_isolation_response:
        type: machine_action
        title: Machine Action Response
        description: A response that includes the result of the action, and supplemental
          information about the action taken
        required: true
        example: {'@odata.context': https://api.securitycenter.windows.com/api/$metadata#MachineActions/$entity,
          id: b89eb834-4578-496c-8be0-03f004061435, type: Unisolate, requestor: user@example.com,
          requestorComment: Isolate machine due to alert 1234, status: InProgress,
          machineId: 1e5bc9d7e413ddd7902c2932e418702b84d0cc07, creationDateTimeUtc: '2017-12-04T12:12:18.9725659Z',
          lastUpdateTimeUtc: '2017-12-04T12:12:18.9725659Z', relatedFileInfo: null}
  stop_and_quarantine_file:
    title: Stop and Quarantine File
    description: Stop the execution of a file on a machine and delete it
    input:
      machine:
        title: Machine
        description: Machine IP address, hostname and machine ID
        type: string
        example: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73
        required: true
      comment:
        type: string
        title: Comment
        description: Comment to associate with the stop and quarantine action
        example: InsightConnect has stopped a file.
        required: true
      sha1:
        type: string
        title: SHA1 Hash
        description: SHA1 hash of the file to stop and quarantine on the machine
        example: ad0c0f2fa80411788e81a4567d1d8758b83cd76e
        required: true
    output:
      stop_and_quarantine_response:
        type: machine_action
        title: Stop and Quarantine Response
        description: A response that includes the result of the action, and supplemental
          information about the action taken
        required: true
        example: {'@odata.context': https://api.securitycenter.windows.com/api/$metadata#MachineActions/$entity,
          id: 141408d1-384c-4c19-8b57-ba39e378011a, type: StopAndQuarantineFile, requestor: user@example.com,
          requestorComment: Stop and quarantine file on machine due to alert 441688558380765161_2136280442,
          status: InProgress, machineId: 1e5bc9d7e413ddd7902c2932e418702b84d0cc07,
          creationDateTimeUtc: '2018-12-04T12:15:04.3825985Z', lastUpdateTimeUtc: '2018-12-04T12:15:04.3825985Z',
          relatedFileInfo: {fileIdentifier: 87662bc3d60e4200ceaf7aae249d1c343f4b83c9,
            fileIdentifierType: Sha1}}
  run_antivirus_scan:
    title: Run Antivirus Scan
    description: Initiate a Windows Defender Antivirus scan on a machine
    input:
      machine:
        title: Machine
        description: Machine IP address, hostname and machine ID
        type: string
        example: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73
        required: true
      comment:
        type: string
        title: Comment
        description: Comment to associate with the antivirus scan action
        example: InsightConnect has started an antivirus scan.
        required: true
      scan_type:
        type: string
        title: Scan Type
        description: The type of antivirus scan to run
        required: true
        example: Full
        enum:
        - Full
        - Quick
    output:
      machine_action_response:
        type: machine_action
        title: Machine Action Response
        description: A response that includes the result of the action, and supplemental
          information about the action taken
        required: true
        example: {'@odata.context': https://api.securitycenter.windows.com/api/$metadata#MachineActions/$entity,
          id: 2e9da30d-27f6-4208-81f2-9cd3d67893ba, type: RunAntiVirusScan, requestor: user@example.com,
          requestorComment: Check machine for viruses due to alert 3212, status: InProgress,
          machineId: 1e5bc9d7e413ddd7902c2932e418702b84d0cc07, creationDateTimeUtc: '2018-12-04T12:18:27.1293487Z',
          lastUpdateTimeUtc: '2018-12-04T12:18:27.1293487Z', relatedFileInfo: null}
  get_machine_action:
    title: Get Machine Action
    description: Retrieve details about an action taken on a machine
    input:
      action_id:
        type: string
        title: Action ID
        description: Action ID
        example: ffd1f0cb-68ad-44ea-bf90-d01061b965ec
        required: true
    output:
      machine_action_response:
        type: machine_action
        title: Machine Action Response
        description: A response that includes the result of the action, and supplemental
          information about the action taken
        required: true
        example: {'@odata.context': https://api.securitycenter.windows.com/api/$metadata#MachineActions/$entity,
          id: 2e9da30d-27f6-4208-81f2-9cd3d67893ba, type: RunAntiVirusScan, requestor: user@example.com,
          requestorComment: Check machine for viruses due to alert 3212, status: InProgress,
          machineId: 1e5bc9d7e413ddd7902c2932e418702b84d0cc07, creationDateTimeUtc: '2018-12-04T12:18:27.1293487Z',
          lastUpdateTimeUtc: '2018-12-04T12:18:27.1293487Z', relatedFileInfo: null}
  find_machines_with_installed_software:
    title: Find Machines with Installed Software
    description: Retrieve a list of device references that have specific software
      installed
    input:
      software:
        title: Software
        description: Name of the software to be searched
        type: string
        required: true
        example: microsoft-_-edge
    output:
      machines:
        title: Machines
        description: List of machines with provided software
        type: '[]machine_software'
        required: true
        example: [{computerDnsName: mseewin10, id: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73,
            osPlatform: Windows10, rbacGroupId: 0}]
  blacklist:
    title: Blacklist
    description: Submit or update new indicator
    input:
      indicator:
        title: Indicator
        description: A supported indicator to blacklist or unblacklist. Supported
          indicators are IP addresses, URLs, domains, and SHA1 and SHA256 hashes
        type: string
        example: 220e7d15b011d7fac48f2bd61114db1022197f7f
        required: true
      action:
        title: Action
        description: The action that will be taken if the indicator will be discovered
          in the organization
        type: string
        example: AlertAndBlock
        default: AlertAndBlock
        required: false
        enum:
        - Alert
        - AlertAndBlock
        - Allowed
        - Audit
        - Block
        - Warn
      application:
        title: Application
        description: The application associated with the indicator
        type: string
        example: demo-test
        required: false
      title:
        title: Title
        description: Indicator alert title
        type: string
        example: test
        required: false
      description:
        title: Description
        description: Description of the indicator
        type: string
        example: Indicator Blacklisted from InsightConnect
        default: Indicator Blacklisted from InsightConnect
        required: false
      expiration_time:
        title: Expiration Time
        description: The expiration time of the indicator, default value is one year
          from now
        type: string
        example: '2020-12-12T00:00:00Z'
        required: false
      severity:
        title: Severity
        description: The severity of the indicator
        type: string
        example: High
        default: High
        required: false
        enum:
        - Informational
        - Low
        - Medium
        - High
      recommended_actions:
        title: Recommended Actions
        description: TI indicator alert recommended actions
        type: string
        example: nothing
        required: false
      rbac_group_names:
        title: RBAC Group Names
        description: List of RBAC group names the indicator would be applied to
        type: '[]string'
        example: '["group1","group2"]'
        required: false
      indicator_state:
        title: Indicator State
        description: True to add indicator, false to remove it from the list
        type: boolean
        example: true
        default: false
        required: false
      generate_alert:
        title: Generate Alerts
        description: True if alert generation is required, False if this indicator
          shouldn't generate an alert. Please note this flag only affects the following
          action types [Allowed, Block, Warn]
        type: boolean
        example: true
        default: false
        required: false
    output:
      indicator_action_response:
        title: Indicator Action Response
        description: A response that includes the result of the action, and supplemental
          information about the action taken
        type: indicator_action
        required: false
        example: {'@odata.context': https://api.securitycenter.windows.com/api/$metadata#Indicators/$entity,
          action: Alert, application: application, category: 1, createdBy: 82f42fca-e931-4f03-b54c-47af94bd394d,
          createdByDisplayName: WindowsDefenderATPSiemConnector, createdBySource: PublicApi,
          creationTimeDateTimeUtc: '2020-07-30T19:01:56.6543461Z', description: some
            description, expirationTime: '2020-12-12T00:00:00Z', generateAlert: true,
          historicalDetection: false, id: '11', indicatorType: Url, indicatorValue: http://google.com,
          lastUpdateTime: '2020-07-30T19:02:10.9680026Z', lastUpdatedBy: 82f42fca-e931-4f03-b54c-47af94bd394d,
          mitreTechniques: [], rbacGroupIds: [], rbacGroupNames: [], recommendedActions: nothing,
          severity: Informational, source: WindowsDefenderATPSiemConnector, sourceType: AadApp,
          title: Title}
  get_machine_vulnerabilities:
    title: Get Machine Vulnerabilities
    description: Retrieves a collection of discovered vulnerabilities related to a
      given device
    input:
      machine:
        title: Machine
        description: Machine IP address, hostname or machine ID
        type: string
        example: 9de5069c5afe602b2ea0a04b66beb2c0cef77fdf
        required: true
    output:
      vulnerabilities:
        type: '[]vulnerability'
        title: Vulnerabilities
        description: List of vulnerabilities of the machine
        required: true
        example: [{id: CVE-2020-14711, name: CVE-2020-14711, description: 'Vulnerability
              in the Oracle VM VirtualBox product of Oracle Virtualization (component:
              Core).  Supported versions that are affected are Prior to 5.2.44, prior
              to 6.0.24 and  prior to 6.1.12. Easily exploitable vulnerability allows
              high privileged attacker with logon to the infrastructure where Oracle
              VM VirtualBox executes to compromise Oracle VM VirtualBox.  Successful
              attacks require human interaction from a person other than the attacker.
              Successful attacks of this vulnerability can result in takeover of Oracle
              VM VirtualBox.  Note: The CVE-2020-14711 is applicable to macOS host
              only. CVSS 3.1 Base Score 6.5 (Confidentiality, Integrity and Availability
              impacts).  CVSS Vector: (CVSS:3.1/AV:L/AC:L/PR:H/UI:R/S:U/C:H/I:H/A:H).',
            severity: Medium, cvssV3: 6.5, exposedMachines: 1, publishedOn: '2020-07-14T00:00:00Z',
            updatedOn: '2020-07-27T22:00:00Z', publicExploit: false, exploitVerified: false,
            exploitInKit: false, exploitTypes: [], exploitUris: []}]
  get_security_recommendations:
    title: Get Security Recommendations
    description: Retrieve a list of security recommendations
    input:
      machine:
        title: Machine
        description: Machine IP address, hostname or machine ID
        type: string
        example: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73
        required: true
    output:
      recommendations:
        title: Recommendations
        description: List of security recommendations
        type: '[]recommendation'
        required: true
        example: [{activeAlert: false, associatedThreats: [], configScoreImpact: 0.0,
            exposedMachinesCount: 1, exposureImpact: 0.0, id: va-_-microsoft-_-.net_framework,
            nonProductivityImpactedAssets: 0, productName: .net_framework, publicExploit: false,
            recommendationCategory: Application, recommendationName: Update Microsoft
              .net Framework, relatedComponent: .net Framework, remediationType: Update,
            severityScore: 0.0, status: Active, totalMachineCount: 0, vendor: microsoft,
            weaknesses: 1}]
  get_missing_software_updates:
    title: Get Missing Software Updates
    description: Retrieve a list of software updates
    input:
      machine:
        title: Machine
        description: Machine IP address, hostname or machine ID
        type: string
        example: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73
        required: true
    output:
      updates:
        title: Updates
        description: List of updates
        type: '[]update'
        required: true
        example: [{machineMissedOn: 1, name: September 2020 Security Updates, osBuild: 17763,
            productsNames: [windows_10, internet_explorer], url: https://catalog.update.microsoft.com/v7/site/Searc...,
            cveAddressed: 68, id: '4570333'}]
  get_installed_software:
    title: Get Installed Software
    description: Retrieves a collection of installed software related to a given machine
      IP address, hostname, or machine ID
    input:
      machine:
        title: Machine
        description: Machine IP address, hostname, or machine ID
        type: string
        example: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73
        required: true
    output:
      software:
        title: Software
        description: List of installed software on the machine
        type: '[]software'
        required: true
        example: [{publicExploit: true, vendor: microsoft, weaknesses: 1056, activeAlert: false,
            exposedMachines: 1, id: microsoft-_-windows_10, impactScore: 63.8, name: windows_10},
          {exposedMachines: 0, id: microsoft-_-edge_chromium-based, impactScore: 0,
            name: edge_chromium-based, publicExploit: false, vendor: microsoft, weaknesses: 0,
            activeAlert: false}]
  manage_tags:
    title: Manage Tags
    description: Add or remove machine tags
    input:
      machine:
        title: Machine
        description: Machine IP address, hostname, or machine ID
        type: string
        example: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73
        required: true
      tag:
        title: Tag
        description: The tag value
        type: string
        example: example tag
        required: true
      type:
        title: Type
        description: True to add tag, false to remove it
        type: boolean
        example: true
        default: true
        required: true
    output:
      manage_tags_response:
        title: Manage Tags Response
        description: A response that includes updated tags and supplemental information
          about the machine
        type: manage_tags_response
        required: true
        example: {computerDnsName: msedgewin10, deviceValue: Normal, machineTags: [
            tag1, tag2, example tag], riskScore: None, '@odata.context': https://api.securitycenter.windows.com/api/$metada...,
          id: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73, osProcessor: x64, rbacGroupId: 0,
          version: '1809', osPlatform: Windows10, agentVersion: 10.5850.17763.348,
          exposureLevel: Medium, isAadJoined: false, lastExternalIpAddress: 83.220.117.67,
          lastIpAddress: 10.0.2.15, osBuild: 17763, firstSeen: '2020-12-08T09:33:03.1262943Z',
          healthStatus: Active, lastSeen: '2020-12-08T10:37:41.2907723Z'}
  get_related_machines:
    title: Get Related Machines
    description: Get machines related to an file hash(SHA1), domain or username indicator
    input:
      indicator:
        title: Indicator
        description: File hash(SHA1), domain or username indicator
        type: string
        example: example.com
        required: true
    output:
      machines:
        title: Machines
        description: Machines related to an file hash(SHA1), domain or username indicator
        type: '[]machine'
        required: true
        example: [{exposureLevel: Medium, lastIpAddress: 10.0.2.15, machineTags: [
              tag1, tag2], agentVersion: 10.5850.17763.348, lastSeen: '2020-12-08T10:37:41.2907723Z',
            osBuild: 17763, osPlatform: Windows10, rbacGroupId: 0, computerDnsName: msedgewin10,
            firstSeen: '2020-12-08T09:33:03.1262943Z', osProcessor: x64, version: '1809',
            deviceValue: Normal, healthStatus: Active, id: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73,
            isAadJoined: false, lastExternalIpAddress: 83.220.117.67, riskScore: None}]
  collect_investigation_package:
    title: Collect Investigation Package
    description: Collects investigation package from a machine
    input:
      machine:
        title: Machine
        description: Machine IP address, hostname, or machine ID
        type: string
        example: 2df36d707c1ee5084cef77f3dbfc95db65bc4a73
        required: true
      comment:
        title: Comment
        description: Comment to associate with the action
        type: string
        example: Investigation package collected via InsightConnect
        default: Investigation package collected via InsightConnect
        required: false
    output:
      collect_investigation_package_response:
        title: Collect Investigation Package Response
        description: A response that includes information about the action taken
        type: machine_action
        required: true
        example: {collect_investigation_package_response: {requestorComment: Investigation
              package collected via InsightConnect, status: Pending, type: CollectInvestigationPackage,
            commands: [], creationDateTimeUtc: '2021-02-25T13:53:29.1889041Z', requestSource: PublicApi,
            id: 7de39b39-107e-4556-855b-25cf652835ef, lastUpdateDateTimeUtc: '2021-02-25T13:53:29.1889041Z',
            machineId: 8de370ca0e0e58ff2c2513bbc16f632ffa6e6024, requestor: b6e46392-61b9-48c0-ada3-63e3cd30d95b,
            '@odata.context': https://api.securitycenter.windows.com/api/$metada...,
            computerDnsName: msedgewin10, errorHResult: 0}}
  update_alert:
    title: Update Alert
    description: Updates properties of existing alert
    input:
      alert_id:
        title: Alert ID
        description: ID of alert to update
        type: string
        example: 12168855_8380765161_2136280442
        required: true
      alert_fields:
        title: Alert Fields
        description: Fields of the alert to update
        type: object
        required: true
        example: {status: Resolved, assignedTo: user@example.com, classification: FalsePositive,
          determination: Malware, comment: Resolve my alert and assign to secop2}
    output:
      alert:
        title: Alert
        description: Alert entity with the updated properties
        type: Alert
        required: true
        example: {id: da637292082891366787_322129023, incidentId: 1, investigationId: 1,
          assignedTo: Automation, severity: Informational, status: Resolved, investigationState: Benign,
          detectionSource: WindowsDefenderAv, category: Malware, title: EICAR_Test_File
            malware was detected, description: 'Malware and unwanted software are
            undesirable applications that perform annoying, disruptive, or harmful
            actions on affected machines. Some of these undesirable applications can
            replicate and spread from one machine to another. Others are able to receive
            commands from remote attackers and perform activities associated with
            cyber attacks. This detection might indicate that the malware was stopped
            from delivering its payload. However, it is prudent to check the machine
            for signs of infection.', alertCreationTime: '2020-07-01T13:51:29.0741799Z',
          firstEventTime: '2020-07-01T13:49:55.2853766Z', lastEventTime: '2020-07-01T13:49:55.8520351Z',
          lastUpdateTime: '2020-07-02T20:11:23.0966667Z', resolvedTime: '2020-07-01T14:02:24.4812386Z',
          machineId: 2df36d707c1ee508xyFf77f3dbfc95db65bc4a73, computerDnsName: example-desktop,
          aadTenantId: 5c824599-ab2c-43ab-651x-3b886d4f8f10, comments: [], evidence: []}
triggers:
  get_alert_matching_key:
    title: Get Alerts Matching Key
    description: Get alerts that match a given key to its value
    input:
      key:
        type: string
        description: The key to look for in the alert. This key must match the case
          shown in the example output section in help
        example: assignedTo
        required: true
        order: 1
      value:
        type: string
        description: The value to look for in the alert. The value must match the
          case of the value returned
        example: user@example.com
        required: true
        order: 2
      frequency:
        type: integer
        description: Poll frequency in seconds
        default: 10
        example: 10
        required: false
        order: 3
    output:
      alert:
        title: Alert
        description: An alert that contains the given key and matching value
        type: alert
        required: true
        example: {alert: {id: da637292082891366787_322129023, incidentId: 1, investigationId: 1,
            assignedTo: Automation, severity: Informational, status: Resolved, investigationState: Benign,
            detectionSource: WindowsDefenderAv, category: Malware, title: EICAR_Test_File
              malware was detected, description: "Malware and unwanted software are\
              \ undesirable applications that perform annoying, disruptive, or harmful\
              \ actions on affected machines. Some of these undesirable applications\
              \ can replicate and spread from one machine to another. Others are able\
              \ to receive commands from remote attackers and perform activities associated\
              \ with cyber attacks.\n\nThis detection might indicate that the malware\
              \ was stopped from delivering its payload. However, it is prudent to\
              \ check the machine for signs of infection.", alertCreationTime: '2020-07-01T13:51:29.0741799Z',
            firstEventTime: '2020-07-01T13:49:55.2853766Z', lastEventTime: '2020-07-01T13:49:55.8520351Z',
            lastUpdateTime: '2020-07-02T20:11:23.0966667Z', resolvedTime: '2020-07-01T14:02:24.4812386Z',
            machineId: 2df36d707c1ee508xyFf77f3dbfc95db65bc4a73, computerDnsName: example-desktop,
            aadTenantId: 5c824599-ab2c-43ab-651x-3b886d4f8f10, comments: [], evidence: [
              {entityType: User, evidenceCreationTime: '2021-01-26T20:33:58.42Z',
                sha1: ff836cfb1af40252bd2a2ea843032e99a5b262ed, sha256: a4752c71d81afd3d5865d24ddb11a6b0c615062fcc448d24050c2172d2cbccd6,
                fileName: rundll32.exe, filePath: C:\Windows\SysWOW64, processId: 3276,
                processCommandLine: 'rundll32.exe  c:\temp\suspicious.dll,RepeatAfterMe',
                processCreationTime: '2021-01-26T20:31:32.9581596Z', parentProcessId: 8420,
                parentProcessCreationTime: '2021-01-26T20:31:32.9004163Z', parentProcessFileName: rundll32.exe,
                parentProcessFilePath: C:\Windows\System32, ipAddress: 8.8.8.8, url: null,
                registryKey: Test9999, registryHive: null, registryValueType: null,
                registryValue: null, accountName: name, domainName: DOMAIN, userSid: S-1-5-21-11111607-1111760036-109187956-75141,
                aadUserId: 11118379-2a59-1111-ac3c-a51eb4a3c627, userPrincipalName: user@example.com,
                detectionStatus: Detected}]}}
  get_alerts:
    title: Get Alerts
    description: Return all new alerts
    input:
      frequency:
        type: integer
        description: Poll frequency in seconds
        default: 10
        example: 10
        required: false
    output:
      alert:
        title: Alert
        description: Alert
        type: alert
        required: true
        example: {id: da637292082891366787_322129023, incidentId: 1, investigationId: 1,
          assignedTo: Automation, severity: Informational, status: Resolved, investigationState: Benign,
          detectionSource: WindowsDefenderAv, category: Malware, title: EICAR_Test_File
            malware was detected, description: 'Malware and unwanted software are
            undesirable applications that perform annoying, disruptive, or harmful
            actions on affected machines. Some of these undesirable applications can
            replicate and spread from one machine to another. Others are able to receive
            commands from remote attackers and perform activities associated with
            cyber attacks. This detection might indicate that the malware was stopped
            from delivering its payload. However, it is prudent to check the machine
            for signs of infection.', alertCreationTime: '2020-07-01T13:51:29.0741799Z',
          firstEventTime: '2020-07-01T13:49:55.2853766Z', lastEventTime: '2020-07-01T13:49:55.8520351Z',
          lastUpdateTime: '2020-07-02T20:11:23.0966667Z', resolvedTime: '2020-07-01T14:02:24.4812386Z',
          machineId: 2df36d707c1ee508xyFf77f3dbfc95db65bc4a73, computerDnsName: example-desktop,
          aadTenantId: 5c824599-ab2c-43ab-651x-3b886d4f8f10, comments: [], evidence: []}
