plugin_spec_version: v2
extension: plugin
products: [insightconnect]
name: palo_alto_cortex_xdr
title: Palo Alto Cortex XDR
description: Stop modern attacks with the industry's first extended detection and response platform that spans your endpoints, network and cloud data
version: 4.0.0
connection_version: 2
sdk:
  type: slim
  version: 6.0.1
  user: nobody
supported_versions: ["2024-07-15 Palo Alto Cortex XDR API"]
vendor: rapid7
support: rapid7
status: []
resources:
  source_url: https://github.com/rapid7/insightconnect-plugins/tree/master/plugins/palo_alto_cortex_xdr
  license_url: https://github.com/rapid7/insightconnect-plugins/blob/master/LICENSE
  vendor_url: https://www.paloaltonetworks.com/cortex/cortex-xdr
tags:
  - cortex xdr
  - palo alto
  - endpoint
  - detection
hub_tags:
  use_cases: [threat_detection_and_response]
  keywords: [cortex, endpoint, detection]
  features: []
requirements:
  - "A Palo Alto Cortex XDR API key"
  - "A Palo Alto Cortex XDR API key ID"
  - "The URL to your Palo Alto Cortex XDR API instance"
key_features:
  - "Get Endpoint Information"
  - "Isolate or Unisolate an endpoint"
  - "Add files to the block or allow lists"
troubleshooting: "Isolate Endpoint fails with 500 error - This will happen if an isolation action (Isolate or Unisolate) is in progress on the selected endpoint. Wait a few minutes and try again."
version_history:
  - "4.0.0 - `Get Alerts`: Fixed issue where trigger was failing due to empty output fields"
  - "3.0.0 - Updated `hosts` output of `Get Incident` trigger and `Monitor Incident Events` task to separate host values | Update `insightconnect-plugin-runtime` to version 5"
  - "2.3.0 - Add types `xql_query_result` to `Get XQL Query Results` action's response | Add new trigger `Get Query Results`"
  - "2.2.1 - Fix issue in Get Incidents trigger where fields with null values were causing trigger to fail"
  - "2.2.0 - New action Get XQL Query Results | Update SDK to insightconnect-python-3-38-slim-plugin:4"
  - "2.1.1 - Fix issue in Monitor Incident Events task where fields with null values aren't removed from incidents leading to validation errors"
  - "2.1.0 - New task Monitor Incident Events"
  - "2.0.0 - New action Get File Quarantine Status | New trigger Get Alerts"
  - "1.0.0 - Initial plugin"
links:
  - "[Palo Alto Cortex XDR](https://www.paloaltonetworks.com/cortex/cortex-xdr)"
references:
  - "This plugin was tested using Viewer, Security Admin, and Instance Administrator Roles using both Standard and Advanced Security Levels. Please ensure your selected Role has adequate permissions to perform the desired actions."
types:
  alert:
    agent_os_sub_type:
      title: Agent OS Sub Type
      description: The subtype of the operating system running on the agent.
      type: string
      required: false
    category:
      title: Category
      description: The general category of the event.
      type: string
      required: false
    causality_actor_process_command_line:
      title: Causality Actor Process Command Line
      description: The command line arguments of the causality actor process.
      type: '[]string'
      required: false
    causality_actor_process_image_md5:
      title: Causality Actor Process Image MD5
      description: The MD5 hash of the causality actor process image.
      type: '[]string'
      required: false
    causality_actor_process_image_name:
      title: Causality Actor Process Image Name
      description: The name of the causality actor process image.
      type: '[]string'
      required: false
    causality_actor_process_image_path:
      title: Causality Actor Process Image Path
      description: The path to the causality actor process image.
      type: '[]string'
      required: false
    causality_actor_process_image_sha256:
      title: Causality Actor Process Image SHA256
      description: The SHA256 hash of the causality actor process image.
      type: '[]string'
      required: false
    causality_actor_process_signature_status:
      title: Causality Actor Process Signature Status
      description: The status of the signature associated with the causality actor process.
      type: '[]string'
      required: false
    causality_actor_process_signature_vendor:
      title: Causality Actor Process Signature Vendor
      description: The vendor of the signature associated with the causality actor process.
      type: '[]string'
      required: false
    causality_actor_causality_id:
      title: Causality Actor Causality ID
      description: The causality ID of the causality actor.
      type: '[]string'
      required: false
    contains_featured_host:
      title: Contains Featured Host
      description: Indicates if the event contains a featured host.
      type: '[]string'
      required: false
    contains_featured_ip:
      title: Contains Featured IP
      description: Indicates if the event contains a featured IP address.
      type: '[]string'
      required: false
    contains_featured_user:
      title: Contains Featured User
      description: Indicates if the event contains a featured user.
      type: '[]string'
      required: false
    action_country:
      title: Action Country
      description: The country where the action took place.
      type: '[]string'
      required: false
    description:
      title: Description
      description: A textual description of the event.
      type: string
      required: false
    event_type:
      title: Event Type
      description: The type of the event.
      type: '[]string'
      required: false
    is_whitelisted:
      title: Is Whitelisted
      description: Indicates if the event is whitelisted.
      type: boolean
      required: false
    action_file_macro_sha256:
      title: Action File Macro SHA256
      description: The SHA256 hash of the macro file involved in the action.
      type: string
      required: false
    action_file_md5:
      title: Action File MD5
      description: The MD5 hash of the file involved in the action.
      type: string
      required: false
    action_file_name:
      title: Action File Name
      description: The name of the file involved in the action.
      type: string
      required: false
    action_file_path:
      title: Action File Path
      description: The path to the file involved in the action.
      type: string
      required: false
    action_file_sha256:
      title: Action File SHA256
      description: The SHA256 hash of the file involved in the action.
      type: string
      required: false
    fw_device_name:
      title: Firewall Device Name
      description: The name of the firewall device.
      type: string
      required: false
    agent_fqdn:
      title: Agent Fully Qualified Domain Name
      description: The fully qualified domain name of the agent.
      type: string
      required: false
    agent_os_type:
      title: Agent Operating System Type
      description: The type of the operating system running on the agent.
      type: string
      required: false
    image_name:
      title: Image Name
      description: The name of the image.
      type: string
      required: false
    actor_process_image_name:
      title: Actor Process Image Name
      description: The name of the actor process image.
      type: '[]string'
      required: false
    actor_process_command_line:
      title: Actor Process Command Line
      description: The command line arguments of the actor process.
      type: '[]string'
      required: false
    actor_process_image_md5:
      title: Actor Process Image MD5
      description: The MD5 hash of the actor process image.
      type: '[]string'
      required: false
    actor_process_image_path:
      title: Actor Process Image Path
      description: The path to the actor process image.
      type: '[]string'
      required: false
    actor_process_os_pid:
      title: Actor Process Operating System PID
      description: The process ID of the actor process on the operating system.
      type: '[]integer'
      required: false
    actor_process_image_sha256:
      title: Actor Process Image SHA256
      description: The SHA256 hash of the actor process image.
      type: '[]string'
      required: false
    actor_process_signature_status:
      title: Actor Process Signature Status
      description: The status of the signature associated with the actor process.
      type: '[]string'
      required: false
    actor_process_signature_vendor:
      title: Actor Process Signature Vendor
      description: The vendor of the signature associated with the actor process.
      type: '[]string'
      required: false
    actor_thread_thread_id:
      title: Actor Thread Thread ID
      description: The thread ID of the actor thread.
      type: '[]integer'
      required: false
    fw_is_phishing:
      title: Firewall Is Phishing
      description: Indicates if the event is related to phishing.
      type: '[]string'
      required: false
    mitre_tactic_id_and_name:
      title: MITRE Tactic ID and Name
      description: The ID and name of the MITRE tactic.
      type: '[]string'
      required: false
    mitre_technique_id_and_name:
      title: MITRE Technique ID and Name
      description: The ID and name of the MITRE technique.
      type: '[]string'
      required: false
    module_id:
      title: Module ID
      description: The ID of the module.
      type: '[]string'
      required: false
    os_actor_process_command_line:
      title: OS Actor Process Command Line
      description: The command line arguments of the OS actor process.
      type: '[]string'
      required: false
    os_actor_thread_thread_id:
      title: OS Actor Thread Thread ID
      description: The thread ID of the OS actor thread.
      type: '[]integer'
      required: false
    os_actor_process_image_name:
      title: OS Actor Process Image Name
      description: The name of the OS actor process image.
      type: '[]string'
      required: false
    os_actor_process_os_pid:
      title: OS Actor Process Operating System PID
      description: The process ID of the OS actor process on the operating system.
      type: '[]integer'
      required: false
    os_actor_process_image_sha256:
      title: OS Actor Process Image SHA256
      description: The SHA256 hash of the OS actor process image.
      type: '[]string'
      required: false
    os_actor_process_signature_status:
      title: OS Actor Process Signature Status
      description: The status of the signature associated with the OS actor process.
      type: '[]string'
      required: false
    os_actor_process_signature_vendor:
      title: OS Actor Process Signature Vendor
      description: The vendor of the signature associated with the OS actor process.
      type: '[]string'
      required: false
    action_process_signature_status:
      title: Action Process Signature Status
      description: The status of the signature associated with the action process.
      type: '[]string'
      required: false
    matching_service_rule_id:
      title: Matching Service Rule ID
      description: The ID of the service rule matched.
      type: string
      required: false
    starred:
      title: Starred
      description: Indicates if the alert is starred.
      type: boolean
      required: false
    external_id:
      title: External ID
      description: An external identifier for the alert.
      type: string
      required: false
    severity:
      title: Severity
      description: The severity level of the alert.
      type: string
      required: false
    matching_status:
      title: Matching Status
      description: The status of the matching process.
      type: string
      required: false
    local_insert_ts:
      title: Local Insert Timestamp
      description: The timestamp when the alert was inserted locally.
      type: integer
      required: false
    attempt_counter:
      title: Attempt Counter
      description: The counter for attempts made.
      type: integer
      required: false
    case_id:
      title: Case ID
      description: The case ID associated with the alert.
      type: integer
      required: false
    agent_version:
      title: Agent Version
      description: The version of the agent.
      type: string
      required: false
    agent_data_collection_status:
      title: Agent Data Collection Status
      description: The status of data collection by the agent.
      type: boolean
      required: false
    agent_is_vdi:
      title: Agent Is VDI
      description: Indicates if the agent is running on a VDI.
      type: boolean
      required: false
    agent_install_type:
      title: Agent Install Type
      description: The install type of the agent.
      type: string
      required: false
    agent_host_boot_time:
      title: Agent Host Boot Time
      description: The boot time of the host.
      type: '[]integer'
      required: false
    event_sub_type:
      title: Event Sub Type
      description: The subtype of the event.
      type: '[]integer'
      required: false
    association_strength:
      title: Association Strength
      description: The strength of association between entities.
      type: '[]integer'
      required: false
    event_timestamp:
      title: Event Timestamp
      description: The timestamp of the event.
      type: '[]integer'
      required: false
    actor_process_instance_id:
      title: Actor Process Instance ID
      description: The instance ID of the actor process.
      type: '[]string'
      required: false
    causality_actor_process_execution_time:
      title: Causality Actor Process Execution Time
      description: The execution time of the causality actor process.
      type: '[]integer'
      required: false
    os_actor_process_image_path:
      title: OS Actor Process Image Path
      description: The path to the OS actor process image.
      type: '[]string'
      required: false
    is_pcap:
      title: Is PCAP
      description: Indicates if the alert involves PCAP data.
      type: boolean
      required: false
    alert_type:
      title: Alert Type
      description: The type of the alert.
      type: string
      required: false
    resolution_status:
      title: Resolution Status
      description: The resolution status of the alert.
      type: string
      required: false
    tags:
      title: Tags
      description: Tags associated with the alert.
      type: '[]string'
      required: false
    alert_id:
      title: Alert ID
      description: The unique ID of the alert.
      type: string
      required: false
    detection_timestamp:
      title: Detection Timestamp
      description: The timestamp when the detection occurred.
      type: integer
      required: false
    name:
      title: Name
      description: The name of the alert.
      type: string
      required: false
    endpoint_id:
      title: Endpoint ID
      description: The ID of the endpoint.
      type: string
      required: false
    host_ip:
      title: Host IP
      description: The IP address of the host.
      type: '[]string'
      required: false
    host_name:
      title: Host Name
      description: The name of the host.
      type: string
      required: false
    action:
      title: Action
      description: The action taken.
      type: string
      required: false
    original_tags:
      title: Original Tags
      description: The original tags associated with the alert.
      type: '[]string'
      required: false
    user_name:
      title: User Name
      description: The name of the user.
      type: '[]string'
      required: false
    mac_addresses:
      title: MAC Addresses
      description: The MAC addresses associated with the alert.
      type: '[]string'
      required: false
    source:
      title: Source
      description: The source of the alert.
      type: string
      required: false
    action_pretty:
      title: Action Pretty
      description: A pretty-printed representation of the action.
      type: string
      required: false
  incident:
    alert_count:
      title: Alert Count
      type: integer
      description: Alert count
      required: false
    assigned_user_mail:
      title: Assigned User Mail
      type: string
      description: Assigned user mail
      required: false
    assigned_user_pretty_name:
      title: Assigned User Pretty Name
      type: string
      description: Assigned user pretty name
      required: false
    creation_time:
      title: Creation Time
      type: integer
      description: Creation time
      required: false
    description:
      title: Description
      type: string
      description: Description
      required: false
    detection_time:
      title: Detection Time
      type: string
      description: Detection time
      required: false
    high_severity_alert_count:
      title: High Severity Alert Count
      type: integer
      description: High severity alert count
      required: false
    host_count:
      title: Host Count
      type: integer
      description: Host count
      required: false
    hosts:
      title: Hosts
      type: "[]string"
      description: Hosts
      required: false
    incident_id:
      title: Incident ID
      type: string
      description: Incident ID
      required: false
    incident_name:
      title: Incident Name
      type: string
      description: Incident name
      required: false
    incident_sources:
      title: Incident Sources
      type: "[]string"
      description: Incident sources
      required: false
    low_severity_alert_count:
      title: Low Severity Alert Count
      type: integer
      description: Low severity alert count
      required: false
    manual_description:
      title: Manual Description
      type: string
      description: Manual description
      required: false
    manual_score:
      title: Manual Score
      type: string
      description: Manual score
      required: false
    manual_severity:
      title: Manual Severity
      type: string
      description: Manual severity
      required: false
    med_severity_alert_count:
      title: Med Severity Alert Count
      type: integer
      description: Med severity alert count
      required: false
    modification_time:
      title: Modification Time
      type: integer
      description: Modification time
      required: false
    notes:
      title: Notes
      type: string
      description: Notes
      required: false
    resolve_comment:
      title: Resolve Comment
      type: string
      description: Resolve comment
      required: false
    rule_based_score:
      title: Rule Based Score
      type: string
      description: Rule based score
      required: false
    severity:
      title: Severity
      type: string
      description: Severity
      required: false
    starred:
      title: Starred
      type: boolean
      description: Starred
      required: false
    status:
      title: Status
      type: string
      description: Status
      required: false
    user_count:
      title: User Count
      type: integer
      description: User count
      required: false
    users:
      title: Users
      type: "[]string"
      description: Users
      required: false
    xdr_url:
      title: XDR URL
      type: string
      description: XDR URL
      required: false
  isolation_result:
    action_id:
      title: Action ID
      type: integer
      description: Action ID
      required: false
    status:
      title: Status
      type: string
      description: Status
      required: false
    endpoints_count:
      title: Endpoints Count
      type: integer
      description: Endpoints count
      required: false
  endpoint:
    alias:
        title: Alias
        type: string
        description: Alias
        required: false
    content_version:
        title: Content Version
        type: string
        description: Content version
        required: false
    domain:
        title: Domain
        type: string
        description: Domain
        required: false
    endpoint_id:
        title: Endpoint ID
        type: string
        description: Endpoint ID
        required: false
    endpoint_name:
        title: Endpoint Name
        type: string
        description: Endpoint name
        required: false
    endpoint_status:
        title: Endpoint Status
        type: string
        description: Endpoint status
        required: false
    endpoint_type:
        title: Endpoint Type
        type: string
        description: Endpoint type
        required: false
    endpoint_version:
        title: Endpoint Version
        type: string
        description: Endpoint version
        required: false
    first_seen:
        title: First Seen
        type: integer
        description: First seen
        required: false
    install_date:
        title: Install Date
        type: integer
        description: Install date
        required: false
    installation_package:
        title: Installation Package
        type: string
        description: Installation package
        required: false
    ip:
        title: IP
        type: "[]string"
        description: IP
        required: false
    is_isolated:
        title: Is Isolated
        type: string
        description: Is isolated
        required: false
    last_seen:
        title: Last Seen
        type: integer
        description: Last seen
        required: false
    operational_status:
        title: Operational Status
        type: string
        description: Operational status
        required: false
    operational_status_description:
        title: Operational Status Description
        type: string
        description: Operational status description
        required: false
    os_type:
        title: OS Type
        type: string
        description: OS type
        required: false
    scan_status:
        title: Scan Status
        type: string
        description: Scan status
        required: false
    users:
        title: Users
        type: "[]string"
        description: Users
        required: false
  xql_query_result:
    data:
      title: Data
      type: "[]object"
      description: List of obtained data results
      required: false
    stream_id:
      title: Event Subtype
      type: string
      description: String representing a unique ID of more than 1000 number of results
      required: false
  reply:
    status:
      title: Status
      type: string
      description: "API call status: 'SUCCESS', 'FAIL', 'PENDING', 'PARTIAL_SUCCESS'"
      required: false
    number_of_results:
      title: Number of Results
      type: integer
      description: Integer representing the number of results returned
      required: false
    query_cost:
      title: Query Cost
      type: object
      description: Float representing the number of query units collected for this API
      required: false
    remaining_quota:
      title: Remaining Quota
      type: float
      description: Float representing the number of query units available for you to use
      required: false
    results:
      title: Results
      type: xql_query_result
      description: API results according to defined format field
      required: false
connection:
  url:
    title: URL
    description: Cortex XDR API URL
    type: string
    required: true
    example: https://api-example.xdr.us.paloaltonetworks.com/
  api_key_id:
    title: API Key ID
    description: The API Key ID shown in the Cortex XDR API Keys table in settings. e.g. 1, 2, 3
    type: int
    required: true
    example: 1
  api_key:
    title: API Key
    description: The Cortex XDR API Key that is generated when creating a new key
    type: credential_secret_key
    required: true
    example: 1234123412341234asdfasdfasdfasdfasdf1234123412341234123412341234asdfasdfasdfasdfasdf123412341234123412341234asdfasdfasdfasdfasdf
  security_level:
    title: Security Level
    description: The Security Level of the key provided. This can be found in the API Key settings table in the Cortex XDR settings
    type: string
    required: true
    example: Standard
    default: Standard
    enum:
      - Advanced
      - Standard
actions:
  get_file_quarantine_status:
    title: Get File Quarantine Status
    description: Get quarantine status for a file
    input:
      endpoint_id:
        title: Endpoint ID
        type: string
        description: Endpoint ID
        required: true
        example: example_ID
      file_hash:
        title: File Hash
        type: string
        description: File Hash
        required: true
        example: 275a021bbfb6489e54d471899f7db9d1663fc695ec2fe2a2c4538aabf651fd0f
      file_path:
        title: File Path
        type: string
        description: File path
        required: true
        example: powershell.exe
    output:
      file_is_quarantined:
        title: File is Quarantined
        description: Check if the provided file is quarantined
        type: boolean
        required: true
        example: true
  get_endpoint_details:
    title: Get Endpoint Details
    description: Get information about an endpoint
    input:
      endpoint:
        title: Endpoint
        description: The endpoint to get information about. This can be an IPv4 address, hostname, or endpoint ID
        type: string
        required: true
        example: 9de5069c5afe602b2ea0a04b66beb2c0
    output:
      total_count:
        title: Total Count
        description: Number of results found (max 100)
        type: integer
        required: true
        example: 100
      endpoints:
        title: Endpoints
        description: Any endpoints that match the given endpoint information
        type: "[]endpoint"
        required: true
        example: '[ { "Alias": "", "Content Version": {}, "Domain": {}, "Endpoint ID": {}, "Endpoint Name": {}, "Endpoint Status": {}, "Endpoint Type": {}, "Endpoint Version": {}, "First Seen": 0, "IP": [ {} ], "Install Date": {}, "Installation Package": {}, "Is Isolated": {}, "Last Seen": {}, "OS Type": {}, "Operational Status": {}, "Operational Status Description": {}, "Scan Status": {}, "Users": {} } ]'
  isolate_endpoint:
    title: Isolate Endpoint
    description: Isolate or unisolate an endpoint
    input:
      endpoint:
        title: Endpoint
        description: Endpoint to isolate or unisolate. This can be an IPv4 address, hostname, or endpoint ID
        type: string
        required: true
        example: 9de5069c5afe602b2ea0a04b66beb2c0
      isolation_state:
        title: Isolation State
        description: Isolation state to set
        type: string
        required: true
        default: Isolate
        example: Unisolate
        enum:
          - Isolate
          - Unisolate
      whitelist:
        title: Whitelist
        description: This list contains a set of devices that should not be blocked. This can be a combination of IPv4 addresses, hostnames, or endpoint IDs
        type: "[]string"
        required: false
        default: []
        example: ["198.51.100.100", "hostname123", "225494730938493804"]
    output:
      result:
        title: Result
        description: The result of the isolation request
        type: isolation_result
        required: true
        example: '{ "Action ID": 0, "Endpoints Count": {}, "Status": "" }'
  allow_file:
    title: Allow File
    description: Add a file to the allow list
    input:
      file_hash:
        title: File Hash
        description: A SHA256 file hash
        type: string
        required: true
        example: 275a021bbfb6489e54d471899f7db9d1663fc695ec2fe2a2c4538aabf651fd0f
      comment:
        title: Comment
        description: String that represents additional information regarding the action
        type: string
        required: true
        default: File allowed by InsightConnect
        example: File allowed by InsightConnect
      incident_id:
        title: Incident ID
        description: If this is related to an incident, the ID should be entered here
        type: string
        required: false
        example: 5
    output:
      success:
        title: Success
        description: Was the operation successful
        type: boolean
        required: true
        example: true
  block_file:
    title: Block File
    description: Add a file to the block list
    input:
      file_hash:
        title: File Hash
        description: A SHA256 file hash
        type: string
        required: true
        example: 275a021bbfb6489e54d471899f7db9d1663fc695ec2fe2a2c4538aabf651fd0f
      comment:
        title: Comment
        description: String that represents additional information regarding the action
        type: string
        required: true
        default: File blocked by InsightConnect
        example: File blocked by InsightConnect
      incident_id:
        title: Incident ID
        description: If this is related to an incident, the ID should be entered here
        type: string
        required: false
        example: 5
    output:
      success:
        title: Success
        description: Was the operation successful
        type: boolean
        required: true
        example: true
  get_xql_query_results:
    title: Get XQL Query Results
    description: Start an XQL query and retrieve the query results
    input:
      query:
        title: Query
        description: String of the XQL query
        type: string
        required: true
        example: dataset=xdr_data I fields event_id, event_type, event_sub_type I limit 3
      tenants:
        title: Tenants
        description: List of strings used when querying tenants managed by Managed Security Services Providers (MSSP)
        type: "[]string"
        required: true
        example: ["tenantID", "tenantID"]
      end_time:
        title: End Time
        description: Integer in timestamp epoch milliseconds for end of the time range, Cortex XDR calls by default the last 24 hours if both 'Start Time' and 'End Time' values are not present
        type: integer
        required: false
        example: 1598907600000
      start_time:
        title: Start Time
        description: Integer in timestamp epoch milliseconds for start of the time range, Cortex XDR calls by default the last 24 hours if both 'Start Time' and 'End Time' values are not present
        type: integer
        required: false
        example: 1599080399000
      limit:
        title: Limit
        description: Integer representing the maximum number of results to return, defaults to 20, max value 1000
        type: integer
        required: false
        example: 100
        default: 20
    output:
      reply:
        title: Reply
        description: Object containing the query data results
        type: reply
        required: false
        example: '{"Number of Results": 0, "Query Cost": {}, "Remaining Quota": 0.0, "Results": { "Data": [ {} ], "Event Subtype": {} }, "Status": "" }'
triggers:
  get_incidents:
    title: Get Incidents
    description: Get incidents
    input:
      frequency:
        type: integer
        description: Poll frequency in seconds
        default: 5
        example: 5
        required: false
    output:
      incident:
        title: Incident
        description: Incident
        type: incident
        required: false
        example: '{ "Alert Count": 0, "Assigned User Mail": "", "Assigned User Pretty Name": {}, "Creation Time": {}, "Description": {}, "Detection Time": {}, "High Severity Alert Count": {}, "Host Count": {}, "Hosts": [ {} ], "Incident ID": {}, "Incident Name": {}, "Incident Sources": {}, "Low Severity Alert Count": {}, "Manual Description": {}, "Manual Score": {}, "Manual Severity": {}, "Med Severity Alert Count": {}, "Modification Time": {}, "Notes": {}, "Resolve Comment": {}, "Rule Based Score": {}, "Severity": {}, "Starred": "true", "Status": {}, "User Count": {}, "Users": {}, "XDR URL": {} }'
  get_alerts:
    title: Get Alerts
    description: Get alerts
    input:
      frequency:
        type: integer
        description: Poll frequency in seconds
        default: 5
        example: 5
        required: false
    output:
      alert:
        title: Alert
        description: Alert
        type: alert
        required: false
        example: '{"external_id":"12345","severity":"high","matching_status":"UNMATCHABLE","local_insert_ts":1721031230123,"attempt_counter":0,"case_id":1,"is_whitelisted":false,"starred":false,"mitre_technique_id_and_name":["T000.000 - Example Technique: Name"],"mitre_tactic_id_and_name":["ExampleTacticIDName"],"agent_version":"7.5.0.36150","agent_device_domain":"ExampleDomain","agent_fqdn":"ExampleFQDN","agent_os_type":"Windows","agent_os_sub_type":"6","agent_data_collection_status":false,"agent_is_vdi":false,"agent_install_type":"STANDARD","module_id":["Behavioral Threat Protection"],"association_strength":[50],"event_type":["Process Execution"],"event_timestamp":[1721031230123],"actor_process_instance_id":["ExampleID"],"actor_process_image_path":["C:\\Windows\\System32\\cmd.exe"],"actor_process_image_name":["cmd.exe"],"actor_process_command_line":["\"C:\\Windows\\System32\\cmd.exe\" "],"actor_process_signature_status":["N/A"],"actor_process_signature_vendor":["Microsoft Windows","Microsoft Corporation"],"actor_process_image_sha256":["275a021bbfb6489e54d471899f7db9d1663fc695ec2fe2a2c4538aabf651fd0f"],"actor_process_os_pid":[123],"causality_actor_process_signature_status":["N/A"],"action_country":["UNKNOWN"],"action_process_signature_status":["N/A"],"os_actor_process_signature_status":["N/A"],"fw_is_phishing":["N/A"],"is_pcap":false,"contains_featured_host":["NO"],"contains_featured_user":["NO"],"contains_featured_ip":["NO"],"alert_type":"Unclassified","resolution_status":"STATUS_010_NEW","tags":["XDR Agent"],"alert_id":"8","detection_timestamp":1721031230123,"name":"Behavioral Threat","category":"Malware","endpoint_id":"13629dd5c7284859a2954c19c275285f","description":"Example Description","host_ip":["198.51.100.1"],"host_name":"ExampleHostName","action":"BLOCKED","source":"XDR Agent","original_tags":["XDR Agent"],"user_name":["ExampleUsername"],"mac_addresses":["00:00:00:00:00:00"],"action_pretty":"Prevented (Blocked)"}'
  get_query_results:
    title: Get Query Results
    description: Runs the XQL and returns the output data results
    input:
      frequency:
        title: Frequency
        description: Poll frequency in seconds
        type: integer
        required: true
        default: 5
        example: 5
      query:
        title: Query
        description: String of the XQL query
        type: string
        required: true
        example: dataset=xdr_data I fields event_id, event_type, event_sub_type I limit 3
      tenants:
        title: Tenants
        description: List of strings used when querying tenants managed by Managed Security Services Providers (MSSP)
        type: "[]string"
        required: true
        example: ["tenantID", "tenantID"]
      limit:
        title: Limit
        description: Integer representing the maximum number of results to return, defaults to 20, max value 1000
        type: integer
        required: false
        example: 100
        default: 20
    output:
      reply:
        title: Reply
        description: Object containing the query data results
        type: reply
        required: true
        example: '{ "Number of Results": 0, "Query Cost": {}, "Remaining Quota": 0.0, "Results": { "Data": [ {} ], "Event Subtype": {} }, "Status": "" }'
tasks:
  monitor_incident_events:
    title: Monitor Incident Events
    description: Monitor incident events
    input:
      status:
        title: Status
        description: Status
        type: string
        enum:
          - "any"
          - "new"
          - "under_investigation"
          - "resolved_threat_handled"
          - "resolved_known_issue"
          - "resolved_false_positive"
          - "resolved_other"
          - "resolved_auto"
        example: new
        required: false
      incident_id_list:
        title: Incident ID List
        description: Incident ID list
        type: "[]string"
        example: ["5"]
        required: false
      descriptions:
        title: Descriptions
        description: Descriptions
        type: "[]string"
        example: '["Behavioral threat detected (rule: heuristic.b.205)"]'
        required: false
      time_sorting_field:
        title: Time Sorting Field
        description: Field to use to sort Incident events
        type: string
        enum:
          - "modification_time"
          - "creation_time"
        example: modification_time
        required: false
    output:
      events:
        title: Incident Events
        description: Incident events
        type: "[]incident"
        required: false
        example: '[ { "Alert Count": 0, "Assigned User Mail": "", "Assigned User Pretty Name": {}, "Creation Time": {}, "Description": {}, "Detection Time": {}, "High Severity Alert Count": {}, "Host Count": {}, "Hosts": [ {} ], "Incident ID": {}, "Incident Name": {}, "Incident Sources": {}, "Low Severity Alert Count": {}, "Manual Description": {}, "Manual Score": {}, "Manual Severity": {}, "Med Severity Alert Count": {}, "Modification Time": {}, "Notes": {}, "Resolve Comment": {}, "Rule Based Score": {}, "Severity": {}, "Starred": "true", "Status": {}, "User Count": {}, "Users": {}, "XDR URL": {} } ]'
    schedule:
      title: Schedule for Retrieving Events
      type: string
      enum:
        - "cron"
        - "minutes"
      default: minutes
    state:
      last_event_time:
        title: Last Event Time
        description: The datetime of the last retrieved incident event
        type: string