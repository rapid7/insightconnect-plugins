plugin_spec_version: v2
extension: plugin
products: [insightconnect]
name: palo_alto_cortex_xdr
title: Palo Alto Cortex XDR
description: Stop modern attacks with the industry's first extended detection and response platform that spans your endpoints, network and cloud data
version: 3.0.0
connection_version: 2
sdk:
  type: slim
  version: 5
  user: nobody
supported_versions: ["2022-08-09 Palo Alto Cortex XDR API v1"]
vendor: rapid7
support: rapid7
status: []
resources:
  source_url: https://github.com/rapid7/insightconnect-plugins/tree/master/plugins/palo_alto_cortex_xdr
  license_url: https://github.com/rapid7/insightconnect-plugins/blob/master/LICENSE
  vendor_url: https://www.paloaltonetworks.com/cortex/cortex-xdr
tags:
- cortex xdr
- palo alto
- endpoint
- detection
hub_tags:
  use_cases: [threat_detection_and_response]
  keywords: [cortex, endpoint, detection]
  features: []
requirements:
  - A Palo Alto Cortex XDR API key
  - A Palo Alto Cortex XDR API key ID
  - The URL to your Palo Alto Cortex XDR API instance
key_features:
  - Get Endpoint Information
  - Isolate or Unisolate an endpoint
  - Add files to the block or allow lists
types:
  event:
    action_country:
      title: Action Country
      type: string
      description: Action country
      required: false
    action_external_hostname:
      title: Action External Hostname
      type: string
      description: Action external hostname
      required: false
    action_file_macro_sha256:
      title: Action File Macro SHA256
      type: string
      description: Action file macro SHA256
      required: false
    action_file_md5:
      title: Action File MD5
      type: string
      description: Action file MD5
      required: false
    action_file_name:
      title: Action File Name
      type: string
      description: Action file name
      required: false
    action_file_path:
      title: Action File Path
      type: string
      description: Action file path
      required: false
    action_file_sha256:
      title: Action File SHA256
      type: string
      description: Action file SHA256
      required: false
    action_local_ip:
      title: Action Local IP
      type: string
      description: Action local IP
      required: false
    action_local_port:
      title: Action Local Port
      type: string
      description: Action local port
      required: false
    action_process_causality_id:
      title: Action Process Causality ID
      type: string
      description: Action process causality ID
      required: false
    action_process_image_command_line:
      title: Action Process Image Command Line
      type: string
      description: Action process image command line
      required: false
    action_process_image_name:
      title: Action Process Image Name
      type: string
      description: Action process image name
      required: false
    action_process_image_sha256:
      title: Action Process Image SHA256
      type: string
      description: Action process image SHA256
      required: false
    action_process_instance_id:
      title: Action Process Instance ID
      type: string
      description: Action process instance ID
      required: false
    action_process_signature_status:
      title: Action Process Signature Status
      type: string
      description: Action process signature status
      required: false
    action_process_signature_vendor:
      title: Action Process Signature Vendor
      type: string
      description: Action process signature vendor
      required: false
    action_registry_data:
      title: Action Registry Data
      type: string
      description: Action registry data
      required: false
    action_registry_full_key:
      title: Action Registry Full Key
      type: string
      description: Action registry full key
      required: false
    action_registry_key_name:
      title: Action Registry Key Name
      type: string
      description: Action registry key name
      required: false
    action_registry_value_name:
      title: Action Registry Value Name
      type: string
      description: Action registry value name
      required: false
    action_remote_ip:
      title: Action Remote IP
      type: string
      description: Action remote IP
      required: false
    action_remote_port:
      title: Action Remote Port
      type: string
      description: Action remote port
      required: false
    actor_causality_id:
      title: Actor Causality ID
      type: string
      description: Actor causality ID
      required: false
    actor_process_causality_id:
      title: Actor Process Causality ID
      type: string
      description: Actor process causality ID
      required: false
    actor_process_command_line:
      title: Actor Process Command Line
      type: string
      description: Actor process command line
      required: false
    actor_process_image_md5:
      title: Actor Process Image MD5
      type: string
      description: Actor process image MD5
      required: false
    actor_process_image_name:
      title: Actor Process Image Name
      type: string
      description: Actor process image name
      required: false
    actor_process_image_path:
      title: Actor Process Image Path
      type: string
      description: Actor process image path
      required: false
    actor_process_image_sha256:
      title: Actor Process Image SHA256
      type: string
      description: Actor process image SHA256
      required: false
    actor_process_instance_id:
      title: Actor Process Instance ID
      type: string
      description: Actor process instance ID
      required: false
    actor_process_os_pid:
      title: Actor Process OS PID
      type: integer
      description: Actor process OS PID
      required: false
    actor_process_signature_status:
      title: Actor Process Signature Status
      type: string
      description: Actor process signature status
      required: false
    actor_process_signature_vendor:
      title: Actor Process Signature Vendor
      type: string
      description: Actor process signature vendor
      required: false
    actor_thread_thread_id:
      title: Actor Thread Thread ID
      type: string
      description: Actor thread thread ID
      required: false
    agent_host_boot_time:
      title: Agent Host Boot Time
      type: string
      description: Agent host boot time
      required: false
    agent_install_type:
      title: Agent Install Type
      type: string
      description: Agent install type
      required: false
    association_strength:
      title: Association Strength
      type: string
      description: Association strength
      required: false
    causality_actor_causality_id:
      title: Causality Actor Causality ID
      type: string
      description: Causality actor causality ID
      required: false
    causality_actor_process_command_line:
      title: Causality Actor Process Command Line
      type: string
      description: Causality actor process command line
      required: false
    causality_actor_process_execution_time:
      title: Causality Actor Process Execution Time
      type: string
      description: Causality actor process execution time
      required: false
    causality_actor_process_image_md5:
      title: Causality Actor Process Image MD5
      type: string
      description: Causality actor process image MD5
      required: false
    causality_actor_process_image_name:
      title: Causality Actor Process Image Name
      type: string
      description: Causality actor process image name
      required: false
    causality_actor_process_image_path:
      title: Causality Actor Process Image Path
      type: string
      description: Causality actor process image path
      required: false
    causality_actor_process_image_sha256:
      title: Causality Actor Process Image SHA256
      type: string
      description: Causality actor process image SHA256
      required: false
    causality_actor_process_signature_status:
      title: Causality Actor Process Signature Status
      type: string
      description: Causality actor process signature status
      required: false
    causality_actor_process_signature_vendor:
      title: Causality Actor Process Signature Vendor
      type: string
      description: Causality actor process signature vendor
      required: false
    cluster_name:
      title: Cluster Name
      type: string
      description: Cluster name
      required: false
    container_id:
      title: Container ID
      type: string
      description: Container ID
      required: false
    contains_featured_host:
      title: Contains Featured Host
      type: string
      description: Contains featured host
      required: false
    contains_featured_ip:
      title: Contains Featured IP
      type: string
      description: Contains featured IP
      required: false
    contains_featured_user:
      title: Contains Featured User
      type: string
      description: Contains featured user
      required: false
    dns_query_name:
      title: DNS Query Name
      type: string
      description: DNS query name
      required: false
    dst_action_country:
      title: DST Action Country
      type: string
      description: DST action country
      required: false
    dst_action_external_hostname:
      title: DST Action External Hostname
      type: string
      description: DST action external hostname
      required: false
    dst_action_external_port:
      title: DST Action External Port
      type: string
      description: DST action external port
      required: false
    dst_agent_id:
      title: DST Agent ID
      type: string
      description: DST agent ID
      required: false
    dst_association_strength:
      title: DST Association Strength
      type: string
      description: DST association strength
      required: false
    dst_causality_actor_process_execution_time:
      title: DST Causality Actor Process Execution Time
      type: string
      description: DST causality actor process execution time
      required: false
    event_id:
      title: Event ID
      type: string
      description: Event ID
      required: false
    event_sub_type:
      title: Event Sub Type
      type: string
      description: Event sub type
      required: false
    event_timestamp:
      title: Event Timestamp
      type: integer
      description: Event timestamp
      required: false
    event_type:
      title: Event Type
      type: string
      description: Event type
      required: false
    fw_app_category:
      title: FW App Category
      type: string
      description: FW app category
      required: false
    fw_app_id:
      title: FW App ID
      type: string
      description: FW app ID
      required: false
    fw_app_subcategory:
      title: FW App Subcategory
      type: string
      description: FW app subcategory
      required: false
    fw_app_technology:
      title: FW App Technology
      type: string
      description: FW app technology
      required: false
    fw_device_name:
      title: FW Device Name
      type: string
      description: FW device name
      required: false
    fw_email_recipient:
      title: FW Email Recipient
      type: string
      description: FW email recipient
      required: false
    fw_email_sender:
      title: FW Email Sender
      type: string
      description: FW email sender
      required: false
    fw_email_subject:
      title: FW Email Subject
      type: string
      description: FW email subject
      required: false
    fw_interface_from:
      title: FW Interface From
      type: string
      description: FW interface from
      required: false
    fw_interface_to:
      title: FW Interface To
      type: string
      description: FW interface to
      required: false
    fw_is_phishing:
      title: FW Is Phishing
      type: string
      description: FW is phishing
      required: false
    fw_misc:
      title: FW Misc
      type: string
      description: FW misc
      required: false
    fw_rule:
      title: FW Rule
      type: string
      description: FW rule
      required: false
    fw_rule_id:
      title: FW Rule ID
      type: string
      description: FW rule ID
      required: false
    fw_serial_number:
      title: FW Serial Number
      type: string
      description: FW serial number
      required: false
    fw_url_domain:
      title: FW URL Domain
      type: string
      description: FW URL domain
      required: false
    fw_vsys:
      title: FW VSYS
      type: string
      description: FW VSYS
      required: false
    fw_xff:
      title: FW XFF
      type: string
      description: FW XFF
      required: false
    image_name:
      title: Image Name
      type: string
      description: Image name
      required: false
    module_id:
      title: Module ID
      type: string
      description: Module ID
      required: false
    os_actor_causality_id:
      title: OS Actor Causality ID
      type: string
      description: OS actor causality ID
      required: false
    os_actor_effective_username:
      title: OS Actor Effective Username
      type: string
      description: OS actor effective username
      required: false
    os_actor_process_causality_id:
      title: OS Actor Process Causality ID
      type: string
      description: OS actor process causality ID
      required: false
    os_actor_process_command_line:
      title: OS Actor Process Command Line
      type: string
      description: OS actor process command line
      required: false
    os_actor_process_image_name:
      title: OS Actor Process Image Name
      type: string
      description: OS actor process image name
      required: false
    os_actor_process_image_path:
      title: OS Actor Process Image Path
      type: string
      description: OS actor process image path
      required: false
    os_actor_process_image_sha256:
      title: OS Actor Process Image SHA256
      type: string
      description: OS actor process image SHA256
      required: false
    os_actor_process_instance_id:
      title: OS Actor Process Instance ID
      type: string
      description: OS actor process instance ID
      required: false
    os_actor_process_os_pid:
      title: OS Actor Process OS PID
      type: string
      description: OS actor process OS PID
      required: false
    os_actor_process_signature_status:
      title: OS Actor Process Signature Status
      type: string
      description: OS actor process signature status
      required: false
    os_actor_process_signature_vendor:
      title: OS Actor Process Signature Vendor
      type: string
      description: OS actor process signature vendor
      required: false
    os_actor_thread_thread_id:
      title: OS Actor Thread Thread ID
      type: string
      description: OS actor thread thread ID
      required: false
    story_id:
      title: Story ID
      type: string
      description: Story ID
      required: false
    user_name:
      title: User Name
      type: string
      description: User name
      required: false
  alert:
    action:
      title: Action
      type: string
      description: Action
      required: false
    action_pretty:
      title: Action Pretty
      type: string
      description: Action pretty
      required: false
    agent_data_collection_status:
      title: Agent Data Collection Status
      type: boolean
      description: Agent data collection status
      required: false
    agent_device_domain:
      title: Agent Device Domain
      type: string
      description: Agent device domain
      required: false
    agent_fqdn:
      title: Agent FQDN
      type: string
      description: Agent FQDN
      required: false
    agent_os_sub_type:
      title: Agent OS Sub Type
      type: string
      description: Agent OS sub type
      required: false
    agent_os_type:
      title: Agent OS Type
      type: string
      description: Agent OS type
      required: false
    agent_version:
      title: Agent Version
      type: string
      description: Agent version
      required: false
    alert_id:
      title: Alert ID
      type: string
      description: Alert ID
      required: false
    attempt_counter:
      title: Attempt Counter
      type: string
      description: Attempt counter
      required: false
    bioc_category_enum_key:
      title: BIOC Category Enum Key
      type: string
      description: BIOC category enum key
      required: false
    bioc_indicator:
      title: BIOC Indicator
      type: string
      description: BIOC indicator
      required: false
    category:
      title: Category
      type: string
      description: Category
      required: false
    deduplicate_tokens:
      title: Deduplicate Tokens
      type: string
      description: Deduplicate tokens
      required: false
    description:
      title: Description
      type: string
      description: Description
      required: false
    detection_timestamp:
      title: Detection Timestamp
      type: integer
      description: Detection timestamp
      required: false
    end_match_attempt_ts:
      title: End Match Attempt TS
      type: string
      description: End match attempt TS
      required: false
    endpoint_id:
      title: Endpoint ID
      type: string
      description: Endpoint ID
      required: false
    events:
      title: Events
      type: "[]event"
      description: Events
      required: false
    external_id:
      title: External ID
      type: string
      description: External ID
      required: false
    filter_rule_id:
      title: Filter Rule ID
      type: string
      description: Filter rule ID
      required: false
    host_ip:
      title: Host IP
      type: "[]string"
      description: Host IP
      required: false
    host_name:
      title: Host Name
      type: string
      description: Host name
      required: false
    is_whitelisted:
      title: Is Whitelisted
      type: boolean
      description: Is whitelisted
      required: false
    local_insert_ts:
      title: Local Insert TS
      type: integer
      description: Local insert TS
      required: false
    mac:
      title: MAC
      type: string
      description: MAC
      required: false
    mac_addresses:
      title: MAC Addresses
      type: "[]string"
      description: MAC addresses
      required: false
    matching_service_rule_id:
      title: Matching Service Rule ID
      type: string
      description: Matching service rule ID
      required: false
    matching_status:
      title: Matching Status
      type: string
      description: Matching status
      required: false
    mitre_tactic_id_and_name:
      title: MITRE Tactic ID And Name
      type: "[]string"
      description: MITRE tactic ID and name
      required: false
    mitre_technique_id_and_name:
      title: MITRE Technique ID And Name
      type: "[]string"
      description: MITRE technique ID and name
      required: false
    name:
      title: Name
      type: string
      description: Name
      required: false
    severity:
      title: Severity
      type: string
      description: Severity
      required: false
    source:
      title: Source
      type: string
      description: Source
      required: false
    starred:
      title: Starred
      type: boolean
      description: Starred
      required: false
  incident:
    alert_count:
      title: Alert Count
      type: integer
      description: Alert count
      required: false
    assigned_user_mail:
      title: Assigned User Mail
      type: string
      description: Assigned user mail
      required: false
    assigned_user_pretty_name:
      title: Assigned User Pretty Name
      type: string
      description: Assigned user pretty name
      required: false
    creation_time:
      title: Creation Time
      type: integer
      description: Creation time
      required: false
    description:
      title: Description
      type: string
      description: Description
      required: false
    detection_time:
      title: Detection Time
      type: string
      description: Detection time
      required: false
    high_severity_alert_count:
      title: High Severity Alert Count
      type: integer
      description: High severity alert count
      required: false
    host_count:
      title: Host Count
      type: integer
      description: Host count
      required: false
    hosts:
      title: Hosts
      type: "[]string"
      description: Hosts
      required: false
    incident_id:
      title: Incident ID
      type: string
      description: Incident ID
      required: false
    incident_name:
      title: Incident Name
      type: string
      description: Incident name
      required: false
    incident_sources:
      title: Incident Sources
      type: "[]string"
      description: Incident sources
      required: false
    low_severity_alert_count:
      title: Low Severity Alert Count
      type: integer
      description: Low severity alert count
      required: false
    manual_description:
      title: Manual Description
      type: string
      description: Manual description
      required: false
    manual_score:
      title: Manual Score
      type: string
      description: Manual score
      required: false
    manual_severity:
      title: Manual Severity
      type: string
      description: Manual severity
      required: false
    med_severity_alert_count:
      title: Med Severity Alert Count
      type: integer
      description: Med severity alert count
      required: false
    modification_time:
      title: Modification Time
      type: integer
      description: Modification time
      required: false
    notes:
      title: Notes
      type: string
      description: Notes
      required: false
    resolve_comment:
      title: Resolve Comment
      type: string
      description: Resolve comment
      required: false
    rule_based_score:
      title: Rule Based Score
      type: string
      description: Rule based score
      required: false
    severity:
      title: Severity
      type: string
      description: Severity
      required: false
    starred:
      title: Starred
      type: boolean
      description: Starred
      required: false
    status:
      title: Status
      type: string
      description: Status
      required: false
    user_count:
      title: User Count
      type: integer
      description: User count
      required: false
    users:
      title: Users
      type: "[]string"
      description: Users
      required: false
    xdr_url:
      title: XDR URL
      type: string
      description: XDR URL
      required: false
  isolation_result:
    action_id:
      title: Action ID
      type: integer
      description: Action ID
      required: false
    status:
      title: Status
      type: string
      description: Status
      required: false
    endpoints_count:
      title: Endpoints Count
      type: integer
      description: Endpoints count
      required: false
  endpoint:
    alias:
        title: Alias
        type: string
        description: Alias
        required: false
    content_version:
        title: Content Version
        type: string
        description: Content version
        required: false
    domain:
        title: Domain
        type: string
        description: Domain
        required: false
    endpoint_id:
        title: Endpoint ID
        type: string
        description: Endpoint ID
        required: false
    endpoint_name:
        title: Endpoint Name
        type: string
        description: Endpoint name
        required: false
    endpoint_status:
        title: Endpoint Status
        type: string
        description: Endpoint status
        required: false
    endpoint_type:
        title: Endpoint Type
        type: string
        description: Endpoint type
        required: false
    endpoint_version:
        title: Endpoint Version
        type: string
        description: Endpoint version
        required: false
    first_seen:
        title: First Seen
        type: integer
        description: First seen
        required: false
    install_date:
        title: Install Date
        type: integer
        description: Install date
        required: false
    installation_package:
        title: Installation Package
        type: string
        description: Installation package
        required: false
    ip:
        title: IP
        type: "[]string"
        description: IP
        required: false
    is_isolated:
        title: Is Isolated
        type: string
        description: Is isolated
        required: false
    last_seen:
        title: Last Seen
        type: integer
        description: Last seen
        required: false
    operational_status:
        title: Operational Status
        type: string
        description: Operational status
        required: false
    operational_status_description:
        title: Operational Status Description
        type: string
        description: Operational status description
        required: false
    os_type:
        title: OS Type
        type: string
        description: OS type
        required: false
    scan_status:
        title: Scan Status
        type: string
        description: Scan status
        required: false
    users:
        title: Users
        type: "[]string"
        description: Users
        required: false
  xql_query_result:
    data:
      title: Data
      type: "[]object"
      description: List of obtained data results
      required: false
    stream_id:
      title: Event Subtype
      type: string
      description: String representing a unique ID of more than 1000 number of results
      required: false
  reply:
    status:
      title: Status
      type: string
      description: "API call status: 'SUCCESS', 'FAIL', 'PENDING', 'PARTIAL_SUCCESS'"
      required: false
    number_of_results:
      title: Number of Results
      type: integer
      description: Integer representing the number of results returned
      required: false
    query_cost:
      title: Query Cost
      type: object
      description: Float representing the number of query units collected for this API
      required: false
    remaining_quota:
      title: Remaining Quota
      type: float
      description: Float representing the number of query units available for you to use
      required: false
    results:
      title: Results
      type: xql_query_result
      description: API results according to defined format field
      required: false
connection:
  url:
    title: URL
    description: Cortex XDR API URL
    type: string
    required: true
    example: https://api-example.xdr.us.paloaltonetworks.com/
  api_key_id:
    title: API Key ID
    description: The API Key ID shown in the Cortex XDR API Keys table in settings. e.g. 1, 2, 3
    type: int
    required: true
    example: 1
  api_key:
    title: API Key
    description: The Cortex XDR API Key that is generated when creating a new key
    type: credential_secret_key
    required: true
    example: 1234123412341234asdfasdfasdfasdfasdf1234123412341234123412341234asdfasdfasdfasdfasdf123412341234123412341234asdfasdfasdfasdfasdf
  security_level:
    title: Security Level
    description: The Security Level of the key provided. This can be found in the API Key settings table in the Cortex XDR settings
    type: string
    required: true
    example: Standard
    default: Standard
    enum:
      - Advanced
      - Standard
actions:
  get_file_quarantine_status:
    title: Get File Quarantine Status
    description: Get quarantine status for a file
    input:
      endpoint_id:
        title: Endpoint ID
        type: string
        description: Endpoint ID
        required: true
        example: example_ID
      file_hash:
        title: File Hash
        type: string
        description: File Hash
        required: true
        example: 275a021bbfb6489e54d471899f7db9d1663fc695ec2fe2a2c4538aabf651fd0f
      file_path:
        title: File Path
        type: string
        description: File path
        required: true
        example: powershell.exe
    output:
      file_is_quarantined:
        title: File is Quarantined
        description: Check if the provided file is quarantined
        type: boolean
        required: true
        example: true
  get_endpoint_details:
    title: Get Endpoint Details
    description: Get information about an endpoint
    input:
      endpoint:
        title: Endpoint
        description: The endpoint to get information about. This can be an IPv4 address, hostname, or endpoint ID
        type: string
        required: true
        example: 9de5069c5afe602b2ea0a04b66beb2c0
    output:
      total_count:
        title: Total Count
        description: Number of results found (max 100)
        type: integer
        required: true
        example: 100
      endpoints:
        title: Endpoints
        description: Any endpoints that match the given endpoint information
        type: "[]endpoint"
        required: true
        example: '[ { "Alias": "", "Content Version": {}, "Domain": {}, "Endpoint ID": {}, "Endpoint Name": {}, "Endpoint Status": {}, "Endpoint Type": {}, "Endpoint Version": {}, "First Seen": 0, "IP": [ {} ], "Install Date": {}, "Installation Package": {}, "Is Isolated": {}, "Last Seen": {}, "OS Type": {}, "Operational Status": {}, "Operational Status Description": {}, "Scan Status": {}, "Users": {} } ]'
  isolate_endpoint:
    title: Isolate Endpoint
    description: Isolate or unisolate an endpoint
    input:
      endpoint:
        title: Endpoint
        description: Endpoint to isolate or unisolate. This can be an IPv4 address, hostname, or endpoint ID
        type: string
        required: true
        example: 9de5069c5afe602b2ea0a04b66beb2c0
      isolation_state:
        title: Isolation State
        description: Isolation state to set
        type: string
        required: true
        default: Isolate
        example: Unisolate
        enum:
          - Isolate
          - Unisolate
      whitelist:
        title: Whitelist
        description: This list contains a set of devices that should not be blocked. This can be a combination of IPv4 addresses, hostnames, or endpoint IDs
        type: "[]string"
        required: false
        default: []
        example: ["198.51.100.100", "hostname123", "225494730938493804"]
    output:
      result:
        title: Result
        description: The result of the isolation request
        type: isolation_result
        required: true
        example: '{ "Action ID": 0, "Endpoints Count": {}, "Status": "" }'
  allow_file:
    title: Allow File
    description: Add a file to the allow list
    input:
      file_hash:
        title: File Hash
        description: A SHA256 file hash
        type: string
        required: true
        example: 275a021bbfb6489e54d471899f7db9d1663fc695ec2fe2a2c4538aabf651fd0f
      comment:
        title: Comment
        description: String that represents additional information regarding the action
        type: string
        required: true
        default: File allowed by InsightConnect
        example: File allowed by InsightConnect
      incident_id:
        title: Incident ID
        description: If this is related to an incident, the ID should be entered here
        type: string
        required: false
        example: 5
    output:
      success:
        title: Success
        description: Was the operation successful
        type: boolean
        required: true
        example: true
  block_file:
    title: Block File
    description: Add a file to the block list
    input:
      file_hash:
        title: File Hash
        description: A SHA256 file hash
        type: string
        required: true
        example: 275a021bbfb6489e54d471899f7db9d1663fc695ec2fe2a2c4538aabf651fd0f
      comment:
        title: Comment
        description: String that represents additional information regarding the action
        type: string
        required: true
        default: File blocked by InsightConnect
        example: File blocked by InsightConnect
      incident_id:
        title: Incident ID
        description: If this is related to an incident, the ID should be entered here
        type: string
        required: false
        example: 5
    output:
      success:
        title: Success
        description: Was the operation successful
        type: boolean
        required: true
        example: true
  get_xql_query_results:
    title: Get XQL Query Results
    description: Start an XQL query and retrieve the query results
    input:
      query:
        title: Query
        description: String of the XQL query
        type: string
        required: true
        example: dataset=xdr_data I fields event_id, event_type, event_sub_type I limit 3
      tenants:
        title: Tenants
        description: List of strings used when querying tenants managed by Managed Security Services Providers (MSSP)
        type: "[]string"
        required: true
        example: ["tenantID", "tenantID"]
      end_time:
        title: End Time
        description: Integer in timestamp epoch milliseconds for end of the time range, Cortex XDR calls by default the last 24 hours if both 'Start Time' and 'End Time' values are not present
        type: integer
        required: false
        example: 1598907600000
      start_time:
        title: Start Time
        description: Integer in timestamp epoch milliseconds for start of the time range, Cortex XDR calls by default the last 24 hours if both 'Start Time' and 'End Time' values are not present
        type: integer
        required: false
        example: 1599080399000
      limit:
        title: Limit
        description: Integer representing the maximum number of results to return, defaults to 20, max value 1000
        type: integer
        required: false
        example: 100
        default: 20
    output:
      reply:
        title: Reply
        description: Object containing the query data results
        type: reply
        required: false
        example: '{"Number of Results": 0, "Query Cost": {}, "Remaining Quota": 0.0, "Results": { "Data": [ {} ], "Event Subtype": {} }, "Status": "" }'
triggers:
  get_incidents:
    title: Get Incidents
    description: Get incidents
    input:
      frequency:
        type: integer
        description: Poll frequency in seconds
        default: 5
        example: 5
        required: false
    output:
      incident:
        title: Incident
        description: Incident
        type: incident
        required: false
        example: '{ "Alert Count": 0, "Assigned User Mail": "", "Assigned User Pretty Name": {}, "Creation Time": {}, "Description": {}, "Detection Time": {}, "High Severity Alert Count": {}, "Host Count": {}, "Hosts": [ {} ], "Incident ID": {}, "Incident Name": {}, "Incident Sources": {}, "Low Severity Alert Count": {}, "Manual Description": {}, "Manual Score": {}, "Manual Severity": {}, "Med Severity Alert Count": {}, "Modification Time": {}, "Notes": {}, "Resolve Comment": {}, "Rule Based Score": {}, "Severity": {}, "Starred": "true", "Status": {}, "User Count": {}, "Users": {}, "XDR URL": {} }'
  get_alerts:
    title: Get Alerts
    description: Get alerts
    input:
      frequency:
        type: integer
        description: Poll frequency in seconds
        default: 5
        example: 5
        required: false
    output:
      alert:
        title: Alert
        description: Alert
        type: alert
        required: false
        example: '{ "Action": "", "Action Pretty": {}, "Agent Data Collection Status": "true", "Agent Device Domain": {}, "Agent FQDN": {}, "Agent OS Sub Type": {}, "Agent OS Type": {}, "Agent Version": {}, "Alert ID": {}, "Attempt Counter": {}, "BIOC Category Enum Key": {}, "BIOC Indicator": {}, "Category": {}, "Deduplicate Tokens": {}, "Description": {}, "Detection Timestamp": 0, "End Match Attempt TS": {}, "Endpoint ID": {}, "Events": [ { "Action Country": {}, "Action External Hostname": {}, "Action File MD5": {}, "Action File Macro SHA256": {}, "Action File Name": {}, "Action File Path": {}, "Action File SHA256": {}, "Action Local IP": {}, "Action Local Port": {}, "Action Process Causality ID": {}, "Action Process Image Command Line": {}, "Action Process Image Name": {}, "Action Process Image SHA256": {}, "Action Process Instance ID": {}, "Action Process Signature Status": {}, "Action Process Signature Vendor": {}, "Action Registry Data": {}, "Action Registry Full Key": {}, "Action Registry Key Name": {}, "Action Registry Value Name": {}, "Action Remote IP": {}, "Action Remote Port": {}, "Actor Causality ID": {}, "Actor Process Causality ID": {}, "Actor Process Command Line": {}, "Actor Process Image MD5": {}, "Actor Process Image Name": {}, "Actor Process Image Path": {}, "Actor Process Image SHA256": {}, "Actor Process Instance ID": {}, "Actor Process OS PID": {}, "Actor Process Signature Status": {}, "Actor Process Signature Vendor": {}, "Actor Thread Thread ID": {}, "Agent Host Boot Time": {}, "Agent Install Type": {}, "Association Strength": {}, "Causality Actor Causality ID": {}, "Causality Actor Process Command Line": {}, "Causality Actor Process Execution Time": {}, "Causality Actor Process Image MD5": {}, "Causality Actor Process Image Name": {}, "Causality Actor Process Image Path": {}, "Causality Actor Process Image SHA256": {}, "Causality Actor Process Signature Status": {}, "Causality Actor Process Signature Vendor": {}, "Cluster Name": {}, "Container ID": {}, "Contains Featured Host": {}, "Contains Featured IP": {}, "Contains Featured User": {}, "DNS Query Name": {}, "DST Action Country": {}, "DST Action External Hostname": {}, "DST Action External Port": {}, "DST Agent ID": {}, "DST Association Strength": {}, "DST Causality Actor Process Execution Time": {}, "Event ID": {}, "Event Sub Type": {}, "Event Timestamp": {}, "Event Type": {}, "FW App Category": {}, "FW App ID": {}, "FW App Subcategory": {}, "FW App Technology": {}, "FW Device Name": {}, "FW Email Recipient": {}, "FW Email Sender": {}, "FW Email Subject": {}, "FW Interface From": {}, "FW Interface To": {}, "FW Is Phishing": {}, "FW Misc": {}, "FW Rule": {}, "FW Rule ID": {}, "FW Serial Number": {}, "FW URL Domain": {}, "FW VSYS": {}, "FW XFF": {}, "Image Name": {}, "Module ID": {}, "OS Actor Causality ID": {}, "OS Actor Effective Username": {}, "OS Actor Process Causality ID": {}, "OS Actor Process Command Line": {}, "OS Actor Process Image Name": {}, "OS Actor Process Image Path": {}, "OS Actor Process Image SHA256": {}, "OS Actor Process Instance ID": {}, "OS Actor Process OS PID": {}, "OS Actor Process Signature Status": {}, "OS Actor Process Signature Vendor": {}, "OS Actor Thread Thread ID": {}, "Story ID": {}, "User Name": {} } ], "External ID": {}, "Filter Rule ID": {}, "Host IP": [ {} ], "Host Name": {}, "Is Whitelisted": {}, "Local Insert TS": {}, "MAC": {}, "MAC Addresses": {}, "MITRE Tactic ID And Name": {}, "MITRE Technique ID And Name": {}, "Matching Service Rule ID": {}, "Matching Status": {}, "Name": {}, "Severity": {}, "Source": {}, "Starred": {} }'
  get_query_results:
    title: Get Query Results
    description: Runs the XQL and returns the output data results
    input:
      frequency:
        title: Frequency
        description: Poll frequency in seconds
        type: integer
        required: true
        default: 5
        example: 5
      query:
        title: Query
        description: String of the XQL query
        type: string
        required: true
        example: dataset=xdr_data I fields event_id, event_type, event_sub_type I limit 3
      tenants:
        title: Tenants
        description: List of strings used when querying tenants managed by Managed Security Services Providers (MSSP)
        type: "[]string"
        required: true
        example: ["tenantID", "tenantID"]
      limit:
        title: Limit
        description: Integer representing the maximum number of results to return, defaults to 20, max value 1000
        type: integer
        required: false
        example: 100
        default: 20
    output:
      reply:
        title: Reply
        description: Object containing the query data results
        type: reply
        required: true
        example: '{ "Number of Results": 0, "Query Cost": {}, "Remaining Quota": 0.0, "Results": { "Data": [ {} ], "Event Subtype": {} }, "Status": "" }'
tasks:
  monitor_incident_events:
    title: Monitor Incident Events
    description: Monitor incident events
    input:
      status:
        title: Status
        description: Status
        type: string
        enum:
          - "any"
          - "new"
          - "under_investigation"
          - "resolved_threat_handled"
          - "resolved_known_issue"
          - "resolved_false_positive"
          - "resolved_other"
          - "resolved_auto"
        example: new
        required: false
      incident_id_list:
        title: Incident ID List
        description: Incident ID list
        type: "[]string"
        example: ["5"]
        required: false
      descriptions:
        title: Descriptions
        description: Descriptions
        type: "[]string"
        example: '["Behavioral threat detected (rule: heuristic.b.205)"]'
        required: false
      time_sorting_field:
        title: Time Sorting Field
        description: Field to use to sort Incident events
        type: string
        enum:
          - "modification_time"
          - "creation_time"
        example: modification_time
        required: false
    output:
      events:
        title: Incident Events
        description: Incident events
        type: "[]incident"
        required: false
        example: '[ { "Alert Count": 0, "Assigned User Mail": "", "Assigned User Pretty Name": {}, "Creation Time": {}, "Description": {}, "Detection Time": {}, "High Severity Alert Count": {}, "Host Count": {}, "Hosts": [ {} ], "Incident ID": {}, "Incident Name": {}, "Incident Sources": {}, "Low Severity Alert Count": {}, "Manual Description": {}, "Manual Score": {}, "Manual Severity": {}, "Med Severity Alert Count": {}, "Modification Time": {}, "Notes": {}, "Resolve Comment": {}, "Rule Based Score": {}, "Severity": {}, "Starred": "true", "Status": {}, "User Count": {}, "Users": {}, "XDR URL": {} } ]'
    schedule:
      title: Schedule for Retrieving Events
      type: string
      enum:
        - "cron"
        - "minutes"
      default: minutes
    state:
      last_event_time:
        title: Last Event Time
        description: The datetime of the last retrieved incident event
        type: string